import{g as B}from"./storage-4f70fb03.js";import"./querySelectorAll-a0b713c4.js";import{as as Q,d as v,o as i,c as u,F as K,n as O,ar as w,k as r,at as $,aq as h,au as P,B as m,av as q,aw as N,ax as _,ay as G,C as V,a as D,Y as C,az as U,f as W,b as Y,aA as Z,aB as ee,aC as I,h as te,j as E,a2 as M,w as oe,aD as re,aE as T,aF as ne,ag as se}from"./index-3cca530d.js";import{u as ae,f as ie,a as ce}from"./index-e27881ef.js";import{u as F}from"./useLifeHandler.hook-0f32e998.js";import{u as S,C as le}from"./chartEditStore-eacdd3b3.js";import{l as A}from"./listen-42d046d4.js";import{u as ue}from"./useVCharts.hook-51dd6e3b.js";import"./project.api-cdb3f370.js";import"./SettingItem-281a83da.js";/* empty css                                                                      */import"./SettingItemBox-54f3c96d.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-47c71c0e.js";import"./icon-8135a16a.js";import"./index.esm.min-1d723dc8.js";import"./plugin-ede68460.js";import"./vchart-3818fc35.js";import"./fileTypeEnum-21359a08.js";const X=(e,t)=>({zIndex:t+1,left:`${e.x}px`,top:`${e.y}px`}),x=(e,t)=>({width:`${t?t*e.w:e.w}px`,height:`${t?t*e.h:e.h}px`}),H=e=>({display:e.hide?"none":"block"}),j=e=>{const t={};return e&&e.overFlowHidden&&(t.overflow="hidden"),t},de=e=>{const t=e.selectColor?{background:e.background}:{background:`url(${e.backgroundImage}) center center / cover no-repeat !important`};return{position:"relative",width:e.width?`${e.width||100}px`:"100%",height:e.height?`${e.height}px`:"100%",...t}},pe=()=>{window.$KeyboardActive={ctrl:!1,space:!1},document.onkeydown=e=>{const{keyCode:t}=e;if(t==32&&e.target==document.body&&e.preventDefault(),[17,32].includes(t)&&window.$KeyboardActive)switch(t){case 17:window.$KeyboardActive.ctrl=!0;break;case 32:window.$KeyboardActive.space=!0;const s=document.querySelector(".go-preview");s&&s.style.position==="absolute"&&(s.style.cursor="move");break}},document.onkeyup=e=>{const{keyCode:t}=e;if(t==32&&e.target==document.body&&e.preventDefault(),[17,32].includes(t)&&window.$KeyboardActive)switch(t){case 17:window.$KeyboardActive.ctrl=!1;break;case 32:window.$KeyboardActive.space=!1;break}const s=document.querySelector(".go-preview");s&&(s.style.cursor="default")}};let b=[0,0],k=[0,0];const L=e=>{const t=document.querySelector(".go-preview");if(!t||t.style.position!=="absolute"||!window.$KeyboardActive?.space)return;e.preventDefault(),e.stopPropagation(),document.activeElement?.blur();const s=e.screenX,o=e.screenY,a=A(window,"mousemove",Q(d=>{const y=d.screenX-s,n=d.screenY-o,[l,p]=b,[f,g]=k;if(b=[p,y],k=[g,n],t){const z=t.style.left?Number(t.style.left.split("px")[0]):0,J=t.style.top?Number(t.style.top.split("px")[0]):0;t.style.left=z+(p>l?Math.abs(p-l):-Math.abs(p-l))+"px",t.style.top=J+(g>f?Math.abs(g-f):-Math.abs(g-f))+"px"}},20)),c=A(window,"mouseup",()=>{b=[0,0],k=[0,0],a(),c()})},ye=v({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){return(t,s)=>(i(),u("div",{class:w(r($)(e.groupData.styles.animations)),style:h({...r(x)(e.groupData.attr),...r(_)(e.groupData.styles)})},[(i(!0),u(K,null,O(e.groupData.groupList,o=>(i(),u("div",{class:w(["chart-item",r($)(o.styles.animations)]),key:o.id,style:h({...r(X)(o.attr,e.groupIndex),...r(H)(o.status),...r(j)(o.preview),...r(P)(o.styles)})},[(i(),m(V(o.chartConfig.chartKey),q({id:o.id,chartConfig:o,themeSetting:e.themeSetting,themeColor:e.themeColor,style:{...r(x)(o.attr),...r(_)(o.styles),...r(G)(o.styles)}},N(r(F)(o))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))],6))}});const fe=D(ye,[["__scopeId","data-v-6e91b444"]]),he=["id"],me=v({__name:"index",setup(e){const{initDataPond:t,clearMittDataPondMap:s}=ae(),o=S(),a=C(()=>o.editCanvasConfig.chartThemeSetting),c=C(()=>U(o.editCanvasConfig.chartCustomThemeColorInfo)[o.editCanvasConfig.chartThemeColor]);return s(),W(()=>{t(S)}),(d,y)=>(i(!0),u(K,null,O(r(o).componentList,(n,l)=>(i(),u("div",{class:w(["chart-item",r($)(n.styles.animations)]),id:n.id,key:n.id,style:h({...r(X)(n.attr,l),...r(G)(n.styles),...r(H)(n.status),...r(j)(n.preview),...r(P)(n.styles),...r(x)(n.attr)})},[n.isGroup?(i(),m(r(fe),{key:0,groupData:n,groupIndex:l,themeSetting:a.value,themeColor:c.value},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(i(),m(V(n.chartConfig.chartKey),q({key:1,id:n.chartConfig.chartKey==="VCesiumBase"?"cesiumContainer":n.id,chartConfig:n,themeSetting:a.value,themeColor:c.value,style:{...r(x)(n.attr),...r(_)(n.styles)}},N(r(F)(n))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],14,he))),128))}});const R=D(me,[["__scopeId","data-v-cde212f0"]]),ve=e=>{const t=Y(!1),s=setInterval(()=>{if(window.$vue?.component){clearInterval(s);const o=a=>{window.$vue.component(a.chartConfig.chartKey)||window.$vue.component(a.chartConfig.chartKey,ie(a.chartConfig))};e.componentList.forEach(async a=>{a.isGroup?a.groupList.forEach(c=>{o(c)}):o(a)}),t.value=!0}},200);return{show:t}},ge=e=>{const t=S();t.requestGlobalConfig=e[le.REQUEST_GLOBAL_CONFIG]},we=v({__name:"suspenseIndex",async setup(e){let t,s;[t,s]=Z(()=>B()),await t,s();const o=S();ee(`预览-${o.editCanvasConfig.projectName}`);const a=C(()=>({overflow:"hidden",...de(o.editCanvasConfig),..._(o.editCanvasConfig)})),c=C(()=>{const l=o.editCanvasConfig.previewScaleType;return l===I.SCROLL_Y||l===I.SCROLL_X});ge(o);const{entityRef:d,previewRef:y}=ce(o),{show:n}=ve(o);return pe(),ue(o),(l,p)=>(i(),u("div",{class:w(`go-preview ${r(o).editCanvasConfig.previewScaleType}`),onMousedown:p[0]||(p[0]=(...f)=>r(L)&&r(L)(...f))},[c.value?(i(),u("div",{key:0,ref_key:"entityRef",ref:d,class:"go-preview-entity"},[te("div",{ref_key:"previewRef",ref:y,class:"go-preview-scale"},[r(n)?(i(),u("div",{key:0,style:h(a.value)},[E(r(R))],4)):M("",!0)],512)],512)):(i(),u("div",{key:1,ref_key:"previewRef",ref:y,class:"go-preview-scale"},[r(n)?(i(),u("div",{key:0,style:h(a.value)},[E(r(R))],4)):M("",!0)],512))],34))}});const _e=D(we,[["__scopeId","data-v-3f8a603c"]]),Ce=v({__name:"index",setup(e){return(t,s)=>(i(),m(re,null,{default:oe(()=>[E(_e)]),_:1}))}}),Ne=v({__name:"wrapper",setup(e){let t=Y(Date.now());try{[T.JSON,T.CHART_TO_PREVIEW].forEach(o=>{!window.opener||!window.opener.addEventListener||window.opener.addEventListener(o,async a=>{const c=await B();ne(se.GO_CHART_STORAGE_LIST,[{...a.detail,id:c.id}]),t.value=Date.now()})})}catch(s){console.log(s)}return(s,o)=>(i(),m(Ce,{key:r(t)}))}});export{Ne as default};
