import{f as Ye,Z as je,dC as rt,aH as Oe,dD as G,b4 as Ee,ba as Me,a7 as lt,d as q,b9 as ve,M as ge,Y as M,o as x,c as H,r as Xe,F as ae,n as ie,ar as se,aq as V,k as a,a2 as ke,h as I,a as Q,az as Je,B as X,w as S,C as de,at as He,ax as be,ay as Ae,au as Ze,a6 as J,X as Qe,e as Be,a8 as Ge,H as ne,as as et,m as D,dE as ct,W as _e,b as P,dF as Ke,j as T,g as it,q as pe,t as Z,aS as ut,dq as B,dr as N,aT as ue,dp as dt,N as Te,O as xe,b3 as pt,dG as vt,aG as gt,dH as ft,a9 as ht,dI as _t,z as mt,ac as Fe,be as Ct,J as yt,dJ as St,aI as Tt,L as xt,af as wt,ag as Se,aF as $e,dK as Et,c6 as bt}from"./index-3cca530d.js";import{u as Ne,d as Lt}from"./index-1e0fa0cd.js";import{u as ee,g as W,j as k,k as we,a as kt}from"./chartEditStore-eacdd3b3.js";import{e as Dt,a3 as It}from"./index-e27881ef.js";import{a as Mt}from"./useKeyboard.hook-5ecd0895.js";import{u as tt}from"./useSync.hook-0f97b777.js";import{a as $t,b as ze,l as Rt,g as Ut}from"./plugin-ede68460.js";import{u as Ot}from"./useVCharts.hook-51dd6e3b.js";import{C as Ht}from"./index-f0373cd4.js";import"./querySelectorAll-a0b713c4.js";import{l as We}from"./listen-42d046d4.js";import{u as ot,C as st}from"./chartLayoutStore-42609aea.js";import{i as le}from"./icon-8135a16a.js";import{G as At}from"./index.vue_vue_type_script_setup_true_lang-a79bb438.js";import{F as Ve}from"./fileTypeEnum-21359a08.js";import{u as Pt}from"./useSyncUpdate.hook-a702f6d2.js";import"./index-6270b1c7.js";import"./SettingItem-281a83da.js";/* empty css                                                                      */import"./SettingItemBox-54f3c96d.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-47c71c0e.js";import"./index.esm.min-1d723dc8.js";import"./vchart-3818fc35.js";import"./project.api-cdb3f370.js";const fe=ee(),Yt=o=>{let n=()=>{};Ye(async()=>{fe.setEditCanvas(W.EDIT_LAYOUT_DOM,document.getElementById("go-chart-edit-layout")),fe.setEditCanvas(W.EDIT_CONTENT_DOM,document.getElementById("go-chart-edit-content")),await o(),n=fe.listenerScale()}),je(()=>{fe.setEditCanvas(W.EDIT_LAYOUT_DOM,null),fe.setEditCanvas(W.EDIT_CONTENT_DOM,null),n()})},y=ee(),{onClickOutSide:Xt}=Ne(),Bt=async o=>{o.preventDefault();try{$t();const n=o.dataTransfer.getData(rt.DRAG_KEY);if(!n){ze();return}y.setEditCanvas(W.IS_CREATE,!1);const l=Oe(n);if(l.disabled)return;let p=await Dt(l);l.redirectComponent&&(l.dataset&&(p.option.dataset=l.dataset),p.chartConfig.title=l.title,p.chartConfig.chartFrame=l.chartFrame),G(p,o.offsetX-p.attr.w/2,o.offsetY-p.attr.h/2),y.addComponentList(p,!1,!0),y.setTargetSelectChart(p.id),ze()}catch{Rt(),window.$message.warning("图表正在研发中, 敬请期待...")}},qe=o=>{o.preventDefault(),o.stopPropagation(),o.dataTransfer&&(o.dataTransfer.dropEffect="copy")},nt=(o,n)=>{if(n){y.setTargetSelectChart(n.id);return}y.setTargetSelectChart(void 0)},Nt=(o,n)=>{if(o.which==2||window.$KeyboardActive?.space)return;nt();const l=o.offsetX,p=o.offsetY,t=o.screenX,g=o.screenY,i=y.getEditCanvas.scale;y.setMousePosition(void 0,void 0,l,p);const h=Ee.throttle(s=>{y.setTargetSelectChart(),y.setEditCanvas(W.IS_SELECT,!0);const v=l+s.screenX-t,r=p+s.screenY-g;y.setMousePosition(v,r);const e={x1:0,y1:0,x2:0,y2:0};v>l&&r>p?(e.x1=l,e.y1=p,e.x2=Math.round(l+(s.screenX-t)/i),e.y2=Math.round(p+(s.screenY-g)/i)):v>l&&r<p?(e.x1=l,e.y1=Math.round(p-(g-s.screenY)/i),e.x2=Math.round(l+(s.screenX-t)/i),e.y2=p):v<l&&r>p?(e.x1=Math.round(l-(t-s.screenX)/i),e.y1=p,e.x2=l,e.y2=Math.round(p+(s.screenY-g)/i)):(e.x1=Math.round(l-(t-s.screenX)/i),e.y1=Math.round(p-(g-s.screenY)/i),e.x2=l,e.y2=p),y.getComponentList.forEach(w=>{if(!y.getTargetChart.selectId.includes(w.id)){const{x:u,y:c,w:d,h:m}=w.attr,b={x1:u,y1:c,x2:u+d,y2:c+m};b.x1-e.x1>=0&&b.y1-e.y1>=0&&b.x2-e.x2<=0&&b.y2-e.y2<=0&&!w.status.lock&&!w.status.hide&&y.setTargetSelectChart(w.id,!0)}})},30),f=()=>{h.cancel(),y.setEditCanvas(W.IS_SELECT,!1),y.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",f)};document.addEventListener("mousemove",h),document.addEventListener("mouseup",f)},at=()=>({mouseClickHandle:(t,g)=>{if(t.preventDefault(),t.stopPropagation(),!g.status.lock&&window.$KeyboardActive?.ctrl)if(y.targetChart.selectId.includes(g.id)){const i=y.targetChart.selectId.filter(h=>h!==g.id);y.setTargetSelectChart(i)}else y.setTargetSelectChart(g.id,!0)},mousedownHandle:(t,g)=>{if(t.preventDefault(),t.stopPropagation(),g.status.lock||(Xt(),t.buttons===Me.LEFT&&window.$KeyboardActive?.ctrl))return;const i=y.getTargetChart.selectId;if(t.buttons===Me.RIGHT&&i.length>1&&i.includes(g.id)||(y.setTargetSelectChart(g.id),t.buttons===Me.RIGHT))return;const h=y.getEditCanvas.scale,f=y.getEditCanvasConfig.width,s=y.getEditCanvasConfig.height,v=new Map;y.getTargetChart.selectId.forEach(d=>{const m=y.fetchTargetIndex(d);if(m!==-1){const{x:b,y:L,w:E,h:Y}=lt(y.getComponentList[m]).attr;v.set(d,{x:b,y:L,w:E,h:Y})}});const r=t.screenX,e=t.screenY;let w=[];y.getTargetChart.selectId.forEach(d=>{if(!v.has(d))return;const m=y.fetchTargetIndex(d);w.push(Ee.cloneDeep(y.getComponentList[m]))}),y.setMousePosition(void 0,void 0,r,e);const u=Ee.throttle(d=>{y.setEditCanvas(W.IS_DRAG,!0),y.setMousePosition(d.screenX,d.screenY);let m=(d.screenX-r)/h,b=(d.screenY-e)/h;y.getTargetChart.selectId.forEach(L=>{if(!v.has(L))return;const E=y.fetchTargetIndex(L),{x:Y,y:F,w:j,h:A}=v.get(L),_=y.getComponentList[E];let $=Math.round(Y+m),O=Math.round(F+b);const C=50;$=$<-j+C?-j+C:$,O=O<-A+C?-A+C:O,$=$>f-C?f-C:$,O=O>s-C?s-C:O,_&&(_.attr=Object.assign(_.attr,{x:$,y:O}))})},20),c=()=>{try{if(y.setMousePosition(0,0,0,0),y.setEditCanvas(W.IS_DRAG,!1),w.length){y.getTargetChart.selectId.forEach(m=>{if(!v.has(m))return;const b=y.fetchTargetIndex(m),L=y.getComponentList[b];w.forEach(E=>{E.id===m&&(E.attr=Object.assign(E.attr,{offsetX:L.attr.x-E.attr.x,offsetY:L.attr.y-E.attr.y}))})});const d=w.filter(m=>m.attr.offsetX!==0&&m.attr.offsetY!==0);d.length&&y.moveComponentList(d)}document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)}catch(d){console.log(d)}};document.addEventListener("mousemove",u),document.addEventListener("mouseup",c)},mouseenterHandle:(t,g)=>{t.preventDefault(),t.stopPropagation(),y.getEditCanvas.isSelect||y.setTargetHoverChart(g.id)},mouseleaveHandle:(t,g)=>{t.preventDefault(),t.stopPropagation(),y.setEditCanvas(W.IS_DRAG,!1),y.setTargetHoverChart(void 0)}}),Gt=(o,n,l)=>{o.stopPropagation(),o.preventDefault(),y.setEditCanvas(W.IS_DRAG,!0);const p=y.getEditCanvas.scale,t=l.x,g=l.y,i=l.w,h=l.h,f=o.screenX,s=o.screenY;y.setMousePosition(f,s);const v=Ee.throttle(e=>{y.setMousePosition(e.screenX,e.screenY);let w=Math.round((e.screenX-f)/p),u=Math.round((e.screenY-s)/p);const c=/t/.test(n),d=/b/.test(n),m=/l/.test(n),b=/r/.test(n),L=h+(c?-u:d?u:0),E=i+(m?-w:b?w:0);l.h=L>0?L:0,l.w=E>0?E:0,l.x=t+(m?w:0),l.y=g+(c?u:0)},50),r=()=>{y.setEditCanvas(W.IS_DRAG,!1),y.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",v),document.addEventListener("mouseup",r)},Le=(o,n)=>o?{zIndex:n+1,left:`${o.x}px`,top:`${o.y}px`}:{},ce=(o,n)=>o?{width:`${n?n*o.w:o.w}px`,height:`${n?n*o.h:o.h}px`}:{},Kt=(o,n,l,p)=>{const{w:t,h:g}=l,i=/t/.test(o),h=/b/.test(o),f=/l/.test(o),s=/r/.test(o);let v=0,r=0;return o.length===2?(v=f?0:t,r=i?0:g):((i||h)&&(v=t/2,r=i?0:g),(f||s)&&(v=f?0:t,r=Math.floor(g/2))),{left:`${v}px`,top:`${r}px`,cursor:p[n]+"-resize"}},Ft=["onMousedown"],zt=q({__name:"index",props:{item:{type:Object,required:!0},hiddenPoint:{type:Boolean,required:!1}},setup(o){ve(r=>({ab01a3ce:i.value}));const n=o,l=ge(),p=ee(),t=["t","r","b","l","lt","rt","lb","rb"],g=["n","e","s","w","nw","ne","sw","se"],i=M(()=>l.getAppTheme),h=M(()=>p.getEditCanvas[W.IS_DRAG]||n.item.status.lock?!1:n.item.id===p.getTargetChart.hoverId),f=M(()=>{const r=n.item.id;return n.item.status.lock?!1:p.getTargetChart.selectId.find(e=>e===r)}),s=M(()=>n.item.status.lock),v=M(()=>n.item.status.hide);return(r,e)=>(x(),H("div",{class:se(["go-shape-box",{lock:s.value,hide:v.value}])},[Xe(r.$slots,"default",{},void 0,!0),o.hiddenPoint?ke("",!0):(x(!0),H(ae,{key:0},ie(f.value?t:[],(w,u)=>(x(),H("div",{class:se(`shape-point ${w}`),key:u,style:V(a(Kt)(w,u,o.item.attr,g)),onMousedown:c=>a(Gt)(c,w,o.item.attr)},null,46,Ft))),128)),I("div",{class:"shape-modal",style:V(a(ce)(o.item.attr))},[I("div",{class:se(["shape-modal-select",{active:f.value}])},null,2),I("div",{class:se(["shape-modal-change",{selectActive:f.value,hoverActive:h.value}])},null,2)],4)],2))}});const Pe=Q(zt,[["__scopeId","data-v-e6e74e0e"]]),Wt={class:"go-edit-group-box"},Vt=q({__name:"index",props:{groupData:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(o){const n=ee(),{handleContextMenu:l}=Ne(),{mouseenterHandle:p,mouseleaveHandle:t,mousedownHandle:g,mouseClickHandle:i}=at(),h=(v,r,e)=>{const w=u=>r.filter(c=>u.includes(c.key));if(n.getTargetChart.selectId.length>1)return w([J.GROUP,J.DELETE]);{const u=[];e.status.lock?u.push(J.LOCK):u.push(J.UNLOCK),e.status.hide?u.push(J.HIDE):u.push(J.SHOW);const c=[J.UN_GROUP];return[...w(c),Lt(),...v.filter(d=>!u.includes(d.key))]}},f=M(()=>Je(n.getEditCanvasConfig.chartCustomThemeColorInfo)[n.getEditCanvasConfig.chartThemeColor]),s=M(()=>n.getEditCanvasConfig.chartThemeSetting);return(v,r)=>(x(),H("div",Wt,[(x(),X(a(Pe),{key:o.groupData.id,"data-id":o.groupData.id,index:o.groupIndex,item:o.groupData,hiddenPoint:!0,class:se(a(He)(o.groupData.styles.animations)),style:V({...a(Le)(o.groupData.attr,o.groupIndex),...a(ce)(o.groupData.attr),...a(be)(o.groupData.styles),...a(Ae)(o.groupData.styles),...a(Ze)(o.groupData.styles)}),onClick:r[0]||(r[0]=e=>a(i)(e,o.groupData)),onMousedown:r[1]||(r[1]=e=>a(g)(e,o.groupData)),onMouseenter:r[2]||(r[2]=e=>a(p)(e,o.groupData)),onMouseleave:r[3]||(r[3]=e=>a(t)(e,o.groupData)),onContextmenu:r[4]||(r[4]=e=>a(l)(e,o.groupData,h))},{default:S(()=>[(x(!0),H(ae,null,ie(o.groupData.groupList,e=>(x(),X(a(Pe),{key:e.id,"data-id":e.id,index:o.groupIndex,item:e,hiddenPoint:!0,style:V({...a(Le)(e.attr,o.groupIndex)})},{default:S(()=>[(x(),X(de(e.chartConfig.chartKey),{class:se(["edit-content-chart",a(He)(e.styles.animations)]),chartConfig:e,themeSetting:s.value,themeColor:f.value,style:V({...a(ce)(e.attr),...a(be)(e.styles),...a(Ae)(e.styles)})},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","item","style"]))),128))]),_:1},8,["data-id","index","item","class","style"]))]))}}),qt={class:"go-edit-align-line"},jt=q({__name:"index",setup(o){ve(u=>({"2a25621e":i.value}));const n=ge(),l=ee(),p=Qe(),t=Be({lineArr:["rowt","rowc","rowb","coll","colc","colr"],select:new Map,sorptioned:{x:!1,y:!1}}),g=u=>u?{left:`${u.x?u.x:0}px`,top:`${u.y?u.y:0}px`}:{},i=M(()=>n.getAppTheme),h=M(()=>p.getChartAlignRange),f=M(()=>l.getEditCanvas[W.IS_DRAG]),s=(u,c)=>Math.abs(u-c)<=h.value,v=M(()=>l.getTargetChart.selectId),r=M(()=>l.getComponentList[l.fetchTargetIndex()]),e=M(()=>r.value?.attr||{}),w=M(()=>({id:"0",attr:{w:Ge(l.getEditCanvasConfig.width),h:Ge(l.getEditCanvasConfig.height),x:0,y:0,offsetX:0,offsetY:0,zIndex:0}}));return ne(()=>l.getMousePosition,et(()=>{try{if(!f.value||v.value.length!==1)return;const u=e.value.w,c=e.value.h,d=e.value.x,m=d+u/2,b=d+u,L=[d,m,b],E=e.value.y,Y=E+c/2,F=E+c,j=[E,Y,F];t.select.clear(),t.sorptioned.y=!1;const A=l.getComponentList.map(_=>({id:_.id,attr:_.attr}));A.push(w.value),t.lineArr.forEach(_=>{A.forEach($=>{if(v.value[0]===$.id)return;const O=$.attr.w,C=$.attr.h,R=$.attr.x,K=R+O/2,U=R+O,De=[R,K,U],z=$.attr.y,te=z+C/2,oe=z+C,me=[z,te,oe];_.includes("rowt")&&(s(E,z)&&(t.select.set(_,{y:z}),G(r.value,d,z)),s(E,te)&&(t.select.set(_,{y:te}),G(r.value,d,te)),s(E,oe)&&(t.select.set(_,{y:oe}),G(r.value,d,oe))),_.includes("rowc")&&(s(Y,z)&&(t.select.set(_,{y:z}),G(r.value,d,z-c/2)),s(Y,te)&&(t.select.set(_,{y:te}),G(r.value,d,te-c/2)),s(Y,oe)&&(t.select.set(_,{y:oe}),G(r.value,d,oe-c/2))),_.includes("rowb")&&(s(F,z)&&(t.select.set(_,{y:z}),G(r.value,d,z-c)),s(F,te)&&(t.select.set(_,{y:te}),G(r.value,d,te-c)),s(F,oe)&&(t.select.set(_,{y:oe}),G(r.value,d,oe-c))),_.includes("coll")&&(s(d,R)&&(t.select.set(_,{x:R}),G(r.value,R,E)),s(d,K)&&(t.select.set(_,{x:K}),G(r.value,K,E)),s(d,U)&&(t.select.set(_,{x:U}),G(r.value,U,E))),_.includes("colc")&&(s(m,R)&&(t.select.set(_,{x:R}),G(r.value,R-u/2,E)),s(m,K)&&(t.select.set(_,{x:K}),G(r.value,K-u/2,E)),s(m,U)&&(t.select.set(_,{x:U}),G(r.value,U-u/2,E))),_.includes("colr")&&(s(b,R)&&(t.select.set(_,{x:R}),G(r.value,R-u,E)),s(b,K)&&(t.select.set(_,{x:K}),G(r.value,K-u,E)),s(b,U)&&(t.select.set(_,{x:U}),G(r.value,U-u,E)))})})}catch(u){console.log(u)}},200),{deep:!0}),ne(()=>f.value,u=>{u||(t.select.clear(),t.sorptioned.y=!1)}),(u,c)=>(x(),H("div",qt,[(x(!0),H(ae,null,ie(t.lineArr,d=>(x(),H("div",{class:se(["line",[d.includes("row")?"row":"col",t.select.has(d)&&"visible"]]),key:d,style:V(g(t.select.get(d)))},null,6))),128))]))}});const Jt=Q(jt,[["__scopeId","data-v-792c43f5"]]),Zt=q({__name:"index",setup(o){return(n,l)=>{const p=D("n-watermark");return x(),X(p,{id:"go-edit-watermark",content:a(ct),cross:"",selectable:"","font-size":16,"line-height":16,width:500,height:150,"x-offset":12,"y-offset":80,rotate:-15},null,8,["content"])}}});const Qt=Q(Zt,[["__scopeId","data-v-15e7d440"]]),eo=q({__name:"index",setup(o){ve(h=>({"4898c5de":g.value}));const n=ge(),l=ee(),{isSelect:p,scale:t}=_e(l.getEditCanvas),g=M(()=>n.getAppTheme),i=P();return ne(()=>l.getMousePosition,h=>{if(!p.value)return;const{startX:f,startY:s,x:v,y:r}=h,e={zIndex:Ke,x:0,y:0,w:0,h:0,offsetX:0,offsetY:0};v>f&&r>s?(e.x=f,e.y=s,e.w=Math.round((v-f)/t.value),e.h=Math.round((r-s)/t.value)):v>f&&r<s?(e.x=f,e.w=Math.round((v-f)/t.value),e.h=Math.round((s-r)/t.value),e.y=s-e.h):v<f&&r>s?(e.y=s,e.w=Math.round((f-v)/t.value),e.h=Math.round((r-s)/t.value),e.x=f-e.w):(e.w=Math.round((f-v)/t.value),e.h=Math.round((s-r)/t.value),e.x=f-e.w,e.y=s-e.h),i.value={...Le(e,Ke),...ce(e)}},{deep:!0}),(h,f)=>a(p)?(x(),H("div",{key:0,class:"go-edit-select",style:V(i.value)},f[0]||(f[0]=[I("div",{class:"select-background"},null,-1),I("div",{class:"select-border"},null,-1)]),4)):ke("",!0)}});const to=Q(eo,[["__scopeId","data-v-649acbea"]]),oo=q({__name:"index",setup(o){const n=ee(),{getEditCanvasConfig:l,getEditCanvas:p}=_e(n),t=M(()=>({w:l.value.width,h:l.value.height})),g=M(()=>{const h={transform:`scale(${p.value.scale})`};return{...ce(t.value),...h}}),i=M(()=>{const h=p.value.isCreate&&{"z-index":99999};return{...ce(t.value),...h}});return(h,f)=>(x(),H("div",{class:"go-edit-range go-transition",style:V(g.value),onMousedown:f[0]||(f[0]=s=>a(Nt)(s,void 0))},[Xe(h.$slots,"default",{},void 0,!0),T(a(Qt)),T(a(Jt)),T(a(to)),I("div",{class:"go-edit-range-model",style:V(i.value)},null,4)],36))}});const so=Q(oo,[["__scopeId","data-v-78e41de7"]]),no={class:"go-sketch-rule"},Re=20,ao=q({__name:"index",setup(o){ve(C=>({cdea24fc:Y.value,"763b77a0":L.value,"63499e93":r.value}));const n=ee(),l=ot(),p=ge();let t=[0,0],g=[0,0];const i=P(),h=P(!0),f=P(),s=P(),v=P(!1),r=P("auto"),{width:e,height:w}=_e(n.getEditCanvasConfig),u=P(0),c=P(0),d=Be({h:[],v:[]}),m=M(()=>n.getEditCanvas.scale),b=M(()=>`${window.innerWidth*2}px`),L=M(()=>`${w.value*2}px`),E=M(()=>p.getDarkTheme?{bgColor:"#18181c",longfgColor:"#4d4d4d",shortfgColor:"#4d4d4d",fontColor:"#4d4d4d",shadowColor:"#18181c",borderColor:"#18181c",cornerActiveColor:"#18181c"}:{}),Y=M(()=>p.getAppTheme),F=C=>{if(C.ctrlKey||C.metaKey){C.preventDefault();let R=m.value;if(C.wheelDelta>=0&&m.value<2){R=m.value+.05,n.setScale(R);return}C.wheelDelta<0&&m.value>.1&&(R=m.value-.05,n.setScale(R))}},j=()=>{if(!i.value)return;const C=i.value.getBoundingClientRect(),R=f.value.getBoundingClientRect();u.value=(C.left+Re-R.left)/m.value,c.value=(C.top+Re-R.top)/m.value},A=C=>{if(C.preventDefault(),C.stopPropagation(),C.which==2)v.value=!0;else if(!window.$KeyboardActive?.space)return;document.activeElement?.blur();const R=C.pageX,K=C.pageY,U=We(window,"mousemove",z=>{const te=z.pageX-R,oe=z.pageY-K,[me,Ce]=t,[Ie,ye]=g;t=[Ce,te],g=[ye,oe],i.value.scrollLeft-=Ce>me?Math.abs(Ce-me):-Math.abs(Ce-me),i.value.scrollTop-=ye>Ie?Math.abs(ye-Ie):-Math.abs(ye-Ie)}),De=We(window,"mouseup",()=>{U(),De(),t=[0,0],g=[0,0],v.value=!1})},_=()=>{const C=document.getElementById("go-chart-edit-layout");return C?{height:C.clientHeight-20,width:C.clientWidth-20}:{width:e.value,height:w.value}},$=et(()=>{h.value=!1,setTimeout(()=>{h.value=!0},10)},20),O=()=>{const{width:C,height:R}=s.value.getBoundingClientRect(),{width:K,height:U}=_();i.value.scrollLeft=C/2-K/2,i.value.scrollTop=R/2-U/2};return ne(()=>p.getDarkTheme,()=>{$()}),ne(()=>m.value,(C,R)=>{R!==C&&l.getRePositionCanvas&&l.setItemUnHandle(st.RE_POSITION_CANVAS,!1),j(),setTimeout(()=>{O(),$()},400)}),ne(()=>v.value,C=>{r.value=C?"grab":"auto"}),Ye(()=>{i.value&&(i.value.addEventListener("wheel",F,{passive:!1}),O())}),je(()=>{i.value&&i.value.removeEventListener("wheel",F)}),window.onKeySpacePressHold=C=>{v.value=C},(C,R)=>{const K=D("sketch-rule");return x(),H("div",no,[h.value?(x(),X(K,{key:0,thick:Re,scale:m.value,width:_().width,height:_().height,startX:u.value,startY:c.value,lines:d,palette:E.value},null,8,["scale","width","height","startX","startY","lines","palette"])):ke("",!0),I("div",{ref_key:"$app",ref:i,class:"edit-screens",onScroll:j},[I("div",{ref_key:"$container",ref:s,class:"edit-screen-container",style:V({width:b.value})},[I("div",{ref_key:"refSketchRuleBox",ref:f,class:"canvas",onMousedown:A,style:V({marginLeft:"-"+(_().width/2-25)+"px"})},[I("div",{style:V({pointerEvents:v.value?"none":"auto"})},[Xe(C.$slots,"default",{},void 0,!0)],4)],36)],4)],544)])}}});const ro=Q(ao,[["__scopeId","data-v-7cb8cc6f"]]),Ue={[k.ADD]:"新增",[k.DELETE]:"删除",[k.UPDATE]:"更新",[k.MOVE]:"移动",[k.PASTE]:"粘贴",[k.COPY]:"复制",[k.CUT]:"剪切",[k.TOP]:"置顶",[k.BOTTOM]:"置底",[k.UP]:"上移",[k.DOWN]:"下移",[k.GROUP]:"成组",[k.UN_GROUP]:"解组",[k.LOCK]:"锁定",[k.UNLOCK]:"解锁",[k.HIDE]:"隐藏",[k.SHOW]:"显示",[we.CANVAS]:"画布初始化"};var lo=Array.prototype,co=lo.reverse;function io(o){return o==null?o:co.call(o)}var uo=io;const po=it(uo),vo={class:"go-flex-items-center"},go={class:"history-list-box"},fo=["title"],ho=q({__name:"index",setup(o){const{DesktopOutlineIcon:n,PencilIcon:l,TrashIcon:p,CopyIcon:t,LayersIcon:g,DuplicateIcon:i,HelpOutlineIcon:h,LockClosedOutlineIcon:f,LockOpenOutlineIcon:s,EyeOffOutlineIcon:v,EyeOutlineIcon:r}=le.ionicons5,{StackedMoveIcon:e,Carbon3DCursorIcon:w,Carbon3DSoftwareIcon:u}=le.carbon,c=kt(),d=L=>{if(L.targetType===we.CANVAS)return n;switch(L.actionType){case k.UPDATE:return l;case k.DELETE:return p;case k.PASTE:return t;case k.TOP:return g;case k.BOTTOM:return g;case k.UP:return g;case k.DOWN:return g;case k.MOVE:return e;case k.ADD:return i;case k.GROUP:return w;case k.UN_GROUP:return u;case k.LOCK:return f;case k.UNLOCK:return s;case k.HIDE:return v;case k.SHOW:return r;default:return l}},m=L=>{if(L.targetType===we.CANVAS)return Ue[we.CANVAS];if(L.actionType===k.GROUP||L.actionType===k.UN_GROUP)return`${Ue[L.actionType]}`;if(L.historyData.length)return`${Ue[L.actionType]} - ${L.historyData[0].chartConfig.title}`},b=M(()=>{const E=c.getBackStack.map(Y=>({label:m(Y),icon:d(Y)}));return po(E.filter(Y=>Y.label))});return(L,E)=>{const Y=D("n-button"),F=D("n-icon"),j=D("n-text"),A=D("n-scrollbar"),_=D("n-popover"),$=D("n-tooltip");return x(),H("div",vo,[T(_,{class:"edit-history-popover","show-arrow":!1,size:"small",trigger:"click",placement:"top-start"},{trigger:S(()=>[T(Y,{class:"mr-10",secondary:"",size:"small",disabled:b.value.length===0},{default:S(()=>E[0]||(E[0]=[I("span",{class:"btn-text"},"历史记录",-1)])),_:1},8,["disabled"])]),default:S(()=>[I("div",go,[T(A,{style:{"max-height":"500px"}},{default:S(()=>[(x(!0),H(ae,null,ie(b.value,(O,C)=>(x(),H("div",{class:"list-item go-flex-items-center go-ellipsis-1",key:C,title:O.label},[T(F,{class:"item-icon",size:"16",depth:2,component:O.icon},null,8,["component"]),T(j,{depth:"2"},{default:S(()=>[pe(Z(O.label),1)]),_:2},1024)],8,fo))),128))]),_:1}),E[1]||(E[1]=I("div",{class:"popover-modal"},null,-1))])]),_:1}),T($,{trigger:"hover"},{trigger:S(()=>[T(F,{size:"21",depth:3},{default:S(()=>[T(a(h))]),_:1})]),default:S(()=>[I("span",null,"最多只保留"+Z(a(ut))+"条记录",1)]),_:1})])}}});const _o=Q(ho,[["__scopeId","data-v-78517dbe"]]),mo={key:0},Co={key:1},yo=q({__name:"ShortcutKeyModal",props:{modelShow:Boolean},emits:["update:modelShow"],setup(o,{emit:n}){const{CloseIcon:l}=le.ionicons5,p=P(!1),t=n,g=o;ne(()=>g.modelShow,f=>{p.value=f});const i=[{label:"拖拽画布",win:`${B.SPACE.toUpperCase()} + 🖱️ `,mac:`${N.SPACE.toUpperCase()} + 🖱️ `,macSource:!0},{label:"向 上/右/下/左 移动",win:`${B.CTRL.toUpperCase()} + ↑ 或 → 或 ↓ 或 ←`,mac:`${N.CTRL.toUpperCase()} + ↑ `},{label:"锁定",win:`${B.CTRL.toUpperCase()} + L `,mac:`${N.CTRL.toUpperCase()} + L `},{label:"解锁",win:`${B.CTRL.toUpperCase()} + ${B.SHIFT.toUpperCase()}+ L `,mac:`${N.CTRL.toUpperCase()} + ${N.SHIFT.toUpperCase()} + L `},{label:"展示",win:`${B.CTRL.toUpperCase()} + H `,mac:`${N.CTRL.toUpperCase()} + H `},{label:"隐藏",win:`${B.CTRL.toUpperCase()} + ${B.SHIFT.toUpperCase()} + H `,mac:`${N.CTRL.toUpperCase()} + ${N.SHIFT.toUpperCase()} + H `},{label:"删除",win:"Delete".toUpperCase(),mac:`${N.CTRL.toUpperCase()} + Backspace `},{label:"复制",win:`${B.CTRL.toUpperCase()} + C `,mac:`${N.CTRL.toUpperCase()} + C `},{label:"剪切",win:`${B.CTRL.toUpperCase()} + X `,mac:`${N.CTRL.toUpperCase()} + X `},{label:"粘贴",win:`${B.CTRL.toUpperCase()} + V `,mac:`${N.CTRL.toUpperCase()} + V `},{label:"后退",win:`${B.CTRL.toUpperCase()} + Z `,mac:`${N.CTRL.toUpperCase()} + Z `},{label:"前进",win:`${B.CTRL.toUpperCase()} + ${B.SHIFT.toUpperCase()} + Z `,mac:`${N.CTRL.toUpperCase()} + ${N.SHIFT.toUpperCase()} + Z `},{label:"保存",win:`${B.CTRL.toUpperCase()} + S `,mac:`${N.CTRL.toUpperCase()} + S `},{label:"多选",win:`${B.CTRL.toUpperCase()} + 🖱️ `,mac:`${N.CTRL.toUpperCase()} + 🖱️ `},{label:"创建分组",win:`${B.CTRL.toUpperCase()} + G / 🖱️ `,mac:`${N.CTRL.toUpperCase()} + G / 🖱️`},{label:"解除分组",win:`${B.CTRL.toUpperCase()} + ${B.SHIFT.toUpperCase()} + G `,mac:`${N.CTRL.toUpperCase()} + ${B.SHIFT.toUpperCase()} + G `}],h=()=>{t("update:modelShow",!1)};return(f,s)=>{const v=D("n-icon"),r=D("n-space"),e=D("n-gradient-text"),w=D("n-table"),u=D("n-modal");return x(),X(u,{show:p.value,"onUpdate:show":s[0]||(s[0]=c=>p.value=c),"mask-closable":!0,onAfterLeave:h},{default:S(()=>[T(w,{class:"model-content",bordered:!1,"single-line":!1},{default:S(()=>[I("thead",null,[I("tr",null,[s[2]||(s[2]=I("th",null,"功能",-1)),s[3]||(s[3]=I("th",null,"Win 快捷键",-1)),I("th",null,[T(r,{justify:"space-between"},{default:S(()=>[s[1]||(s[1]=I("span",null," Mac 快捷键 ",-1)),T(v,{size:"20",class:"go-cursor-pointer",onClick:h},{default:S(()=>[T(a(l))]),_:1})]),_:1})])])]),I("tbody",null,[(x(),H(ae,null,ie(i,(c,d)=>I("tr",{key:d},[I("td",null,Z(c.label),1),I("td",null,Z(c.win),1),c.macSource?(x(),H("td",mo,Z(c.mac),1)):(x(),H("td",Co,[T(e,{size:22},{default:S(()=>[pe(Z(c.mac.substr(0,1)),1)]),_:2},1024),pe(" + "+Z(c.mac.substr(3)),1)]))])),64))])]),_:1})]),_:1},8,["show"])}}});const So=Q(yo,[["__scopeId","data-v-bbdb0a72"]]),To={class:"go-edit-shortcut"},xo=q({__name:"index",setup(o){const{DicomOverlayIcon:n}=le.carbon,l=P(!1);return(p,t)=>{const g=D("n-icon"),i=D("n-button"),h=D("n-tooltip");return x(),H("div",To,[T(So,{modelShow:l.value,"onUpdate:modelShow":t[0]||(t[0]=f=>l.value=f)},null,8,["modelShow"]),T(h,{trigger:"hover"},{trigger:S(()=>[T(i,{class:"scale-btn",secondary:"",size:"small",onClick:t[1]||(t[1]=f=>l.value=!0)},{default:S(()=>[T(g,{size:"21",depth:3},{default:S(()=>[T(a(n))]),_:1})]),_:1})]),default:S(()=>[t[2]||(t[2]=I("span",null,"快捷键",-1))]),_:1})])}}});const wo=Q(xo,[["__scopeId","data-v-f48c63d8"]]),Eo={class:"go-edit-data-sync go-flex-items-center"},bo=q({__name:"index",setup(o){ve(v=>({"07b59586":g.value}));const{ReloadIcon:n}=le.ionicons5,l=ee(),p=ge(),{saveStatus:t}=_e(l.getEditCanvas),g=P(p.getAppTheme),i=P(""),h=P("");let f=setTimeout(()=>{});const s={[ue.PENDING]:{text:"等待自动同步",type:""},[ue.START]:{text:"正在同步中",type:"success"},[ue.SUCCESS]:{text:"同步成功！",type:"success"},[ue.FAILURE]:{text:"同步失败!",type:"error"}};return ne(()=>t.value,v=>{clearTimeout(f),i.value=s[v].text,h.value=s[v].type,f=setTimeout(()=>{i.value=s[ue.PENDING].text,h.value=s[ue.PENDING].type},3e3)},{immediate:!0}),(v,r)=>{const e=D("n-text"),w=D("n-tooltip"),u=D("n-icon"),c=D("n-spin");return x(),H("div",Eo,[T(w,{trigger:"hover"},{trigger:S(()=>[T(e,{class:"status-desc go-ml-2",type:h.value,depth:"3"},{default:S(()=>[pe(Z(i.value),1)]),_:1},8,["type"])]),default:S(()=>[I("span",null,Z(a(dt))+"s 更新一次",1)]),_:1}),Te(T(c,{class:"go-ml-2",size:"small"},{icon:S(()=>[T(u,{size:"13"},{default:S(()=>[T(a(n))]),_:1})]),_:1},512),[[xe,i.value===s[1].text]])])}}});const Lo=Q(bo,[["__scopeId","data-v-18522cbc"]]),ko={class:"go-edit-bottom"},Do=q({__name:"index",setup(o){ve(b=>({"6f88b5b6":t.value}));const{LockClosedOutlineIcon:n,LockOpenOutlineIcon:l}=le.ionicons5,p=ge(),t=P(p.getAppTheme),g=ot(),i=ee(),{lockScale:h,scale:f}=_e(i.getEditCanvas),s=P(null);let v=[{label:"200%",value:200},{label:"150%",value:150},{label:"100%",value:100},{label:"50%",value:50},{label:"自适应",value:0}];const r=P(""),e=b=>{if(s.value?.blur(),b===0){g.setItemUnHandle(st.RE_POSITION_CANVAS,!0),i.computedScale();return}i.setScale(b/100)},w=()=>{i.setEditCanvas(W.LOCK_SCALE,!h.value)},u=P(100),c=b=>`${b}%`,d=b=>{i.setScale(b/100)},m=Be({100:""});return pt(()=>{const b=(f.value*100).toFixed(0);r.value=`${b}%`,u.value=parseInt(b)}),(b,L)=>{const E=D("n-text"),Y=D("n-divider"),F=D("n-space"),j=D("n-select"),A=D("n-icon"),_=D("n-button"),$=D("n-tooltip"),O=D("n-slider");return x(),H("div",ko,[T(F,null,{default:S(()=>[T(a(_o)),T(E,{id:"keyboard-dress-show",depth:"3"}),T(Y,{vertical:""}),T(a(Lo))]),_:1}),T(F,{class:"bottom-ri"},{default:S(()=>[T(a(wo)),T(j,{ref_key:"selectInstRef",ref:s,class:"scale-btn",value:r.value,"onUpdate:value":[L[0]||(L[0]=C=>r.value=C),e],size:"mini",disabled:a(h),options:a(v)},null,8,["value","disabled","options"]),T($,{trigger:"hover"},{trigger:S(()=>[T(_,{onClick:w,text:""},{default:S(()=>[T(A,{class:se(["lock-icon",{color:a(h)}]),size:"18",depth:2},{default:S(()=>[a(h)?(x(),X(a(n),{key:0})):(x(),X(a(l),{key:1}))]),_:1},8,["class"])]),_:1})]),default:S(()=>[I("span",null,Z(a(h)?"解锁":"锁定")+"当前比例",1)]),_:1}),T(O,{class:"scale-slider",value:u.value,"onUpdate:value":[L[1]||(L[1]=C=>u.value=C),d],"default-value":50,min:10,max:200,step:5,"format-tooltip":c,disabled:a(h),marks:m},null,8,["value","disabled","marks"])]),_:1})])}}});const Io=Q(Do,[["__scopeId","data-v-ce473972"]]),he=ee(),Mo=()=>{he.setTargetSelectChart(void 0),vt(gt(he.getStorageInfo()||[]),void 0,"json");const o=document.querySelector(".go-edit-range"),n=document.getElementById("go-edit-watermark");if(!o||!n){window.$message.error("导出失败！");return}const l=he.getEditCanvas.scale;he.setScale(1,!0),n.style.display="block",setTimeout(()=>{ft(o,()=>{n&&(n.style.display="none"),he.setScale(l,!0)})},600)},$o=()=>{const o=P(),{updateComponent:n}=tt();return{importUploadFileListRef:o,importBeforeUpload:({file:t})=>{o.value=[];const g=t.file.type;return g!==Ve.JSON&&g!==Ve.TXT?(window.$message.warning("仅支持上传 【JSON】 格式文件，请重新上传！"),!1):!0},importCustomRequest:t=>{const{file:g}=t;ht(()=>{g.file?_t(g.file).then(i=>{Ut({message:"请选择导入方式:",positiveText:"新增（可撤回）",negativeText:"覆盖（不可撤回）",negativeButtonProps:{type:"info",ghost:!1},onPositiveCallback:async()=>{try{i=Oe(i),await n(i,!1,!0),window.$message.success("导入成功！")}catch(h){console.log(h),window.$message.error("组件导入失败，请检查文件完整性!")}},onNegativeCallback:async()=>{try{i=Oe(i),await n(i,!0,!0),window.$message.success("导入成功！")}catch(h){console.log(h),window.$message.error("组件导入失败，请检查文件完整性!")}}})}):window.$message.error("导入失败，请检查数据或联系管理员！")})}}};var re=(o=>(o.BUTTON="button",o.IMPORTUPLOAD="importUpload",o))(re||{});const Ro={class:"btn-item"},Uo=q({__name:"index",setup(o){const{DownloadIcon:n,ShareIcon:l,PawIcon:p,SettingsSharpIcon:t,CreateIcon:g}=le.ionicons5,i=Qe(),h=ee();mt(),Pt();let f=null;const s=P(!1),v=P(!0),r=P(!0),{importUploadFileListRef:e,importCustomRequest:w,importBeforeUpload:u}=$o(),c=M(()=>i.getChartToolsStatus===Fe.ASIDE),d=M(()=>i.getChartToolsStatusHide),m=M(()=>v.value&&d.value),b=M(()=>{if(!c.value)return j;const A=[];return j.map(_=>{A.unshift(_)}),A}),L=()=>{f=setTimeout(()=>{v.value&&(v.value=!1,r.value=!0)},200),setTimeout(()=>{r.value=!1},400)},E=()=>{clearTimeout(f),v.value||(v.value=!0)},Y=()=>{window.$message.warning("请通过顶部【同步内容】按钮同步最新数据！"),h.setEditCanvas(W.IS_CODE_EDIT,!0),setTimeout(()=>{const A=yt(St.CHART_EDIT_NAME,"href");if(!A)return;const _=Tt();F(_),xt(A,[_],void 0,!0)},2e3)},F=A=>{const _=h.getStorageInfo(),$=wt(Se.GO_CHART_STORAGE_LIST)||[];if($?.length){const O=$.findIndex(C=>C.id===A);O!==-1?($.splice(O,1,{..._,id:A}),$e(Se.GO_CHART_STORAGE_LIST,$)):($.push({..._,id:A}),$e(Se.GO_CHART_STORAGE_LIST,$))}else $e(Se.GO_CHART_STORAGE_LIST,[{..._,id:A}])},j=[{key:"import",type:re.IMPORTUPLOAD,name:"导入",icon:l},{key:"export",type:re.BUTTON,name:"导出",icon:n,handle:Mo},{key:"edit",type:re.BUTTON,name:"编辑",icon:g,handle:Y},{key:"setting",type:re.BUTTON,name:"设置",icon:t,handle:()=>{s.value=!0}}];return(A,_)=>{const $=D("n-icon"),O=D("n-text"),C=D("n-button"),R=D("n-upload"),K=D("n-tooltip");return x(),H(ae,null,[I("div",{class:se(["go-chart-edit-tools",[a(i).getChartToolsStatus,m.value?"isMini":"unMini"]]),onClick:_[1]||(_[1]=U=>v.value&&(v.value=!1)),onMouseenter:L,onMouseleave:E},[Te(T($,{class:"asideLogo",size:"22"},{default:S(()=>[T(a(p))]),_:1},512),[[xe,a(i).getChartToolsStatus===a(Fe).ASIDE&&m.value]]),(x(!0),H(ae,null,ie(b.value,(U,De)=>(x(),X(K,{key:U.key,disabled:!c.value||d.value&&r.value,trigger:"hover",placement:"left"},{trigger:S(()=>[I("div",Ro,[U.type===a(re).BUTTON?(x(),X(C,{key:0,circle:c.value,secondary:"",onClick:U.handle},{icon:S(()=>[c.value?(x(),X($,{key:0,size:"22"},{default:S(()=>[(x(),X(de(U.icon)))]),_:2},1024)):(x(),X(de(U.icon),{key:1}))]),default:S(()=>[Te(T(O,{depth:"3"},{default:S(()=>[pe(Z(U.name),1)]),_:2},1536),[[xe,!c.value]])]),_:2},1032,["circle","onClick"])):U.type===a(re).IMPORTUPLOAD?(x(),X(R,{key:1,"file-list":a(e),"onUpdate:fileList":_[0]||(_[0]=z=>Ct(e)?e.value=z:null),"show-file-list":!1,customRequest:a(w),onBeforeUpload:a(u)},{default:S(()=>[T(C,{circle:c.value,secondary:""},{icon:S(()=>[c.value?(x(),X($,{key:0,size:"22"},{default:S(()=>[(x(),X(de(U.icon)))]),_:2},1024)):(x(),X(de(U.icon),{key:1}))]),default:S(()=>[Te(T(O,{depth:"3"},{default:S(()=>[pe(Z(U.name),1)]),_:2},1536),[[xe,!c.value]])]),_:2},1032,["circle"])]),_:2},1032,["file-list","customRequest","onBeforeUpload"])):ke("",!0)])]),default:S(()=>[I("span",null,Z(U.name),1)]),_:2},1032,["disabled"]))),128))],34),T(a(At),{modelShow:s.value,"onUpdate:modelShow":_[2]||(_[2]=U=>s.value=U)},null,8,["modelShow"])],64)}}});const Oo=Q(Uo,[["__scopeId","data-v-705dcb7b"]]),Ho=q({__name:"index",setup(o){const n=ee(),{handleContextMenu:l}=Ne(),{dataSyncFetch:p,intervalDataSyncUpdate:t}=tt();Et(),bt(It,null),Yt(async()=>{});const{mouseenterHandle:g,mouseleaveHandle:i,mousedownHandle:h,mouseClickHandle:f}=at(),s=(w,u,c)=>{if(n.getTargetChart.selectId.length>1)return u.filter(m=>[J.GROUP,J.DELETE].includes(m.key));const d=[];return c.status.lock?d.push(J.LOCK):d.push(J.UNLOCK),c.status.hide?d.push(J.HIDE):d.push(J.SHOW),w.filter(m=>!d.includes(m.key))},v=M(()=>n.getEditCanvasConfig.chartThemeSetting),r=M(()=>Je(n.getEditCanvasConfig.chartCustomThemeColorInfo)[n.getEditCanvasConfig.chartThemeColor]);M(()=>n.getEditCanvasConfig.filterShow);const e=M(()=>{const w=n.getEditCanvasConfig.background,u=n.getEditCanvasConfig.backgroundImage;return{...n.getEditCanvasConfig.selectColor?{background:w||void 0}:{background:`url(${u}) no-repeat center center / cover !important`},width:"inherit",height:"inherit"}});return Ot(n),Ye(()=>{Mt(),p()}),(w,u)=>(x(),X(a(Ht),{id:"go-chart-edit-layout",flex:!0,showTop:!1,showBottom:!0,depth:1,xScroll:!0,disabledScroll:!0,onMousedown:a(nt),onDrop:a(Bt),onDragover:a(qe),onDragenter:a(qe)},{aside:S(()=>[T(a(Oo))]),bottom:S(()=>[T(a(Io))]),default:S(()=>[T(a(ro),null,{default:S(()=>[I("div",{id:"go-chart-edit-content",onContextmenu:u[0]||(u[0]=(...c)=>a(l)&&a(l)(...c))},[T(a(so),null,{default:S(()=>[I("div",{style:V({...a(be)(a(n).getEditCanvasConfig),...e.value})},[(x(!0),H(ae,null,ie(a(n).getComponentList,(c,d)=>(x(),H("div",{key:c.id},[c.isGroup?(x(),X(a(Vt),{key:0,groupData:c,groupIndex:d},null,8,["groupData","groupIndex"])):(x(),X(a(Pe),{key:1,"data-id":c.id,index:d,style:V({...a(Le)(c.attr,d),...a(Ze)(c.styles)}),item:c,onClick:m=>a(f)(m,c),onMousedown:m=>a(h)(m,c),onMouseenter:m=>a(g)(m,c),onMouseleave:m=>a(i)(m,c),onContextmenu:m=>a(l)(m,c,s)},{default:S(()=>[(x(),X(de(c.chartConfig.chartKey),{class:se(["edit-content-chart",a(He)(c.styles.animations)]),chartConfig:c,themeSetting:v.value,themeColor:r.value,style:V({...a(ce)(c.attr),...a(be)(c.styles),...a(Ae)(c.styles)})},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","style","item","onClick","onMousedown","onMouseenter","onMouseleave","onContextmenu"]))]))),128))],4)]),_:1})],32)]),_:1})]),_:1},8,["onMousedown","onDrop","onDragover","onDragenter"]))}});const ls=Q(Ho,[["__scopeId","data-v-a95eb3d2"]]);export{ls as default};
