import{d as F,W as B,b as T,aN as z,H as Q,m as l,o as N,B as P,w as t,j as e,h as w,q as u,t as m,k as a,a as O,b9 as W,M as Y,Y as J,b3 as K,c7 as X,c as Z,dM as j,bS as ee,a7 as $,bT as te}from"./index-3cca530d.js";import{i as ae}from"./icon-8135a16a.js";import{S}from"./SettingItem-281a83da.js";import{S as C}from"./SettingItemBox-54f3c96d.js";import"./chartEditStore-eacdd3b3.js";/* empty css                                                                      */import{u as A}from"./useTargetData.hook-52978307.js";import{R as oe,a as ne}from"./pondIndex.vue_vue_type_style_index_0_scoped_a969325e_lang-84087762.js";import{u as se}from"./useSync.hook-0f97b777.js";import"./index-be9f40e9.js";import"./EditorWorker-af30b26c.js";import"./editorWorker-259d4dbf.js";import"./chartLayoutStore-42609aea.js";import"./index-e27881ef.js";import{C as le}from"./index-f8b9aead.js";import"./plugin-ede68460.js";import"./project.api-cdb3f370.js";import"./index-6270b1c7.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-47c71c0e.js";import"./index.esm.min-1d723dc8.js";import"./vchart-3818fc35.js";import"./fileTypeEnum-21359a08.js";const re={class:"go-pr-3"},ue=F({__name:"index",props:{modelShow:Boolean,targetData:Object,saveBtnText:String||null},emits:["update:modelShow","sendHandle"],setup(D,{emit:H}){const c=D,_=H,{targetData:n}=A(),{dataSyncUpdate:q}=se(),{chartConfig:I}=B(c.targetData),{requestContentType:R}=B(c.targetData.request),f=T(!1),k={[z.DEFAULT]:"普通请求",[z.SQL]:"SQL 请求"};Q(()=>c.modelShow,h=>{f.value=h},{immediate:!0});const d=()=>{_("update:modelShow",!1)},g=()=>{_("update:modelShow",!1),_("sendHandle"),q()},v=()=>{d()};return(h,s)=>{const x=l("n-space"),b=l("n-scrollbar"),y=l("n-text"),r=l("n-tag"),o=l("n-button"),U=l("n-card"),i=l("n-modal");return N(),P(i,{class:"go-chart-data-request",show:f.value,"onUpdate:show":s[0]||(s[0]=p=>f.value=p),"mask-closable":!1,closeOnEsc:!0,onEsc:v},{default:t(()=>[e(U,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:t(()=>s[1]||(s[1]=[])),"header-extra":t(()=>s[2]||(s[2]=[])),action:t(()=>[e(x,{justify:"space-between"},{default:t(()=>[w("div",null,[e(y,null,{default:t(()=>[u("「 "+m(a(I).categoryName)+" 」",1)]),_:1}),e(y,null,{default:t(()=>s[3]||(s[3]=[u("—— ")])),_:1}),e(r,{type:"primary",bordered:!1,style:{"border-radius":"5px"}},{default:t(()=>[u(m(k[a(R)]),1)]),_:1})]),w("div",null,[e(o,{class:"go-mr-3",onClick:d},{default:t(()=>s[4]||(s[4]=[u("取消")])),_:1}),e(o,{type:"primary",onClick:g},{default:t(()=>[u(m(D.saveBtnText||"保存 & 发送请求"),1)]),_:1})])]),_:1})]),default:t(()=>[e(b,{style:{"max-height":"718px"}},{default:t(()=>[w("div",re,[e(x,{vertical:""},{default:t(()=>[e(a(oe)),e(a(ne),{"target-data-request":a(n)?.request},null,8,["target-data-request"])]),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),de=O(ue,[["__scopeId","data-v-270d89aa"]]),ie={class:"go-chart-configurations-data-ajax"},ce={class:"go-absolute-center"},pe=F({__name:"index",setup(D){W(r=>({"272613bc":y.value}));const{HelpOutlineIcon:H,FlashIcon:c,PulseIcon:_}=ae.ionicons5,{targetData:n,chartEditStore:q}=A(),{requestOriginUrl:I,requestInterval:R,requestIntervalUnit:f}=B(q.getRequestGlobalConfig),k=Y(),d=T(!1),g=T(!1),v=T(!1);let h=0,s;const x=()=>{g.value=!0},b=async()=>{if(n.value?.request){d.value=!0;try{const r=await ee($(n.value.request),$(q.getRequestGlobalConfig));if(d.value=!1,r){const{data:o}=r;if(!o&&!n.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),v.value=!0;return}n.value.option.dataset=te(o,r,n.value.filter),v.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(r){console.error(r),d.value=!1,window.$message.warning("数据异常，请检查参数！")}}},y=J(()=>k.getAppTheme);return K(()=>{const r=n.value?.filter;s!==r&&h&&(s=r,b()),h++}),X(()=>{s=null}),(r,o)=>{const U=l("n-tag"),i=l("n-input"),p=l("n-icon"),E=l("n-button"),G=l("n-card"),L=l("n-tooltip"),M=l("go-skeleton");return N(),Z("div",ie,[e(G,{class:"n-card-shallow"},{default:t(()=>[e(a(C),{name:"请求配置"},{default:t(()=>[e(a(S),{name:"类型"},{default:t(()=>[e(U,{bordered:!1,type:"primary",style:{"border-radius":"5px"}},{default:t(()=>[u(m(a(n).request.requestContentType===a(z).DEFAULT?"普通请求":"SQL请求"),1)]),_:1})]),_:1}),e(a(S),{name:"方式"},{default:t(()=>[e(i,{size:"small",placeholder:a(n).request.requestHttpType||"暂无",disabled:!0},null,8,["placeholder"])]),_:1}),e(a(S),{name:"组件间隔"},{default:t(()=>[e(i,{size:"small",placeholder:`${a(n).request.requestInterval||"暂无"}`,disabled:!0},{suffix:t(()=>[u(m(a(j)[a(n).request.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]),_:1}),e(a(S),{name:"全局间隔（默认）"},{default:t(()=>[e(i,{size:"small",placeholder:`${a(R)||"暂无"} `,disabled:!0},{suffix:t(()=>[u(m(a(j)[a(f)]),1)]),_:1},8,["placeholder"])]),_:1})]),_:1}),e(a(C),{name:"源地址",alone:!0},{default:t(()=>[e(i,{size:"small",placeholder:a(I)||"暂无",disabled:!0},{prefix:t(()=>[e(p,{component:a(_)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),e(a(C),{name:"组件地址",alone:!0},{default:t(()=>[e(i,{size:"small",placeholder:a(n).request.requestUrl||"暂无",disabled:!0},{prefix:t(()=>[e(p,{component:a(c)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),w("div",{class:"edit-text",onClick:x},[w("div",ce,[e(E,{type:"primary",secondary:""},{default:t(()=>o[1]||(o[1]=[u("编辑配置")])),_:1})])])]),_:1}),e(a(C),{alone:!0},{name:t(()=>[o[3]||(o[3]=u(" 测试 ")),e(L,{trigger:"hover"},{trigger:t(()=>[e(p,{size:"21",depth:3},{default:t(()=>[e(a(H))]),_:1})]),default:t(()=>[o[2]||(o[2]=u(" 默认赋值给 dataset 字段 "))]),_:1})]),default:t(()=>[e(E,{type:"primary",ghost:"",onClick:b},{icon:t(()=>[e(p,null,{default:t(()=>[e(a(c))]),_:1})]),default:t(()=>[o[4]||(o[4]=u(" 发送请求 "))]),_:1})]),_:1}),e(a(le),{show:v.value&&!d.value,ajax:!0},null,8,["show"]),e(M,{load:d.value,repeat:3},null,8,["load"]),e(a(de),{modelShow:g.value,"onUpdate:modelShow":o[0]||(o[0]=V=>g.value=V),targetData:a(n),onSendHandle:b},null,8,["modelShow","targetData"])])}}});const Ee=O(pe,[["__scopeId","data-v-688badbe"]]);export{Ee as default};
