import{M as h}from"./EditorWorker-af30b26c.js";import"./editorWorker-259d4dbf.js";import{d as B,b as $,aE as d,aF as V,ag as R,aG as g,aH as j,aI as A,c as D,j as n,w as t,aB as F,m as a,o as m,h as J,q as l,k as r,B as w,a2 as y,a as L}from"./index-3cca530d.js";import{g as M}from"./storage-4f70fb03.js";import"./querySelectorAll-a0b713c4.js";import{g as v}from"./plugin-ede68460.js";import{i as G}from"./icon-8135a16a.js";import{u as H}from"./useSync.hook-0f97b777.js";import{u as z,P as K}from"./chartEditStore-eacdd3b3.js";import"./project.api-cdb3f370.js";import"./chartLayoutStore-42609aea.js";import"./index-e27881ef.js";import"./SettingItem-281a83da.js";/* empty css                                                                      */import"./SettingItemBox-54f3c96d.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-47c71c0e.js";import"./index.esm.min-1d723dc8.js";import"./vchart-3818fc35.js";import"./fileTypeEnum-21359a08.js";const U={class:"go-edit"},q=B({__name:"index",setup(Q){const S=z(),{dataSyncUpdate:u}=H(),{ChevronBackOutlineIcon:W,DownloadIcon:C,AnalyticsIcon:k}=G.ionicons5,c=window.showOpenFilePicker,s=$("");window.$message.warning("请不要刷新此窗口！");async function E(){const e=await M();F(`编辑-${e.editCanvasConfig.projectName}`),s.value=g(e)}setTimeout(E);function x(){v({message:"导入数据将覆盖内容，此操作不可撤回，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:async()=>{try{const o=await(await c())[0].getFile(),i=new FileReader;i.readAsText(o),i.onloadend=()=>{s.value=(i.result||"").toString()},window.$message.success("导入成功！")}catch(e){window.$message.error("导入失败，请检查文件是否损坏！"),console.log(e)}}})}window.opener.addEventListener(d.CHART,e=>{window.$message.success("正在进行更新..."),V(R.GO_CHART_STORAGE_LIST,[e.detail]),s.value=g(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),p())});async function p(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败！");v({message:"是否覆盖源视图内容? 此操作不可撤！",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:async()=>{try{const e=j(s.value);delete e.id,u&&(S.setProjectInfo(K.PROJECT_ID,A()),await u(!1)),window.opener.dispatchEvent(new CustomEvent(d.JSON,{detail:e})),window.$message.success("正在同步内容...")}catch(e){window.$message.error("内容格式有误"),console.log(e)}}})}return window.onbeforeunload=()=>{window.opener&&window.opener.dispatchEvent(new CustomEvent(d.CLOSE))},(e,o)=>{const i=a("n-text"),_=a("n-icon"),f=a("n-button"),O=a("n-tag"),b=a("n-space"),I=a("n-layout-header"),P=a("n-layout-content"),N=a("n-layout");return m(),D("div",U,[n(N,null,{default:t(()=>[n(I,{class:"go-edit-header go-px-5 go-flex-items-center",bordered:""},{default:t(()=>[J("div",null,[n(i,{class:"go-edit-title go-mr-4"},{default:t(()=>o[1]||(o[1]=[l("页面在线编辑器")])),_:1}),r(c)?(m(),w(f,{key:0,class:"go-mr-3",size:"medium",onClick:x},{icon:t(()=>[n(_,null,{default:t(()=>[n(r(C))]),_:1})]),default:t(()=>[o[2]||(o[2]=l(" 导入 "))]),_:1})):y("",!0)]),n(b,null,{default:t(()=>[n(O,{bordered:!1,type:"warning"},{default:t(()=>o[3]||(o[3]=[l(" 「Ctrl + S 更新视图」 ")])),_:1}),r(c)?(m(),w(f,{key:0,class:"go-mr-3",size:"medium",onClick:p},{icon:t(()=>[n(_,null,{default:t(()=>[n(r(k))]),_:1})]),default:t(()=>[o[4]||(o[4]=l(" 保存 "))]),_:1})):y("",!0)]),_:1})]),_:1}),n(P,null,{default:t(()=>[n(r(h),{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=T=>s.value=T),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}}});const ge=L(q,[["__scopeId","data-v-13e14cec"]]);export{ge as default};
