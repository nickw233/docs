import{d as M,b as H,H as Q,m as a,o as d,B as N,w as t,j as e,q as u,c as I,h as r,k as n,a as V,b9 as de,M as re,W as K,Y as G,a2 as ee,F as Y,n as te,ar as ae,t as A,e as me,dN as B,aN as J,dM as oe,aO as L,a9 as pe,I as _e,b4 as fe,aK as le,a7 as X,b3 as ge,c7 as ve,bS as be,bT as ye}from"./index-3cca530d.js";import{i as Z}from"./icon-8135a16a.js";/* empty css                                                                      */import{S as z}from"./SettingItemBox-54f3c96d.js";import{r as he}from"./chartEditStore-eacdd3b3.js";import{n as qe}from"./noData-e5cefb25.js";import{u as ne}from"./useTargetData.hook-52978307.js";import{g as ue}from"./plugin-ede68460.js";import"./index-be9f40e9.js";import{R as xe,a as we}from"./pondIndex.vue_vue_type_style_index_0_scoped_a969325e_lang-84087762.js";import"./EditorWorker-af30b26c.js";import"./editorWorker-259d4dbf.js";import"./chartLayoutStore-42609aea.js";import"./index-e27881ef.js";import{u as Pe}from"./useSync.hook-0f97b777.js";import{S as j}from"./SettingItem-281a83da.js";import{C as De}from"./index-f8b9aead.js";import"./index-6270b1c7.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-47c71c0e.js";import"./index.esm.min-1d723dc8.js";import"./vchart-3818fc35.js";import"./fileTypeEnum-21359a08.js";import"./project.api-cdb3f370.js";const Ie={class:"go-pr-3"},Ce={key:1},ke=M({__name:"pondIndex",props:{modelShow:Boolean,targetDataRequest:Object},emits:["update:modelShow","editSaveHandle"],setup(i,{emit:T}){const k=i,m=T,{dataSyncUpdate:E}=Pe();H();const v=H(),p=H(!1);Q(()=>k.modelShow,C=>{p.value=C});const _=()=>{m("update:modelShow",!1)},h=()=>{if(!k.targetDataRequest?.dataPondName){window.$message.warning("请在左下角输入名称！"),v.value?.focus();return}ue({message:"保存内容将同步修改所有使用此接口的组件, 是否继续?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{m("update:modelShow",!1),m("editSaveHandle",k.targetDataRequest),E()}})},S=()=>{_()};return(C,o)=>{const q=a("n-space"),x=a("n-scrollbar"),g=a("n-tag"),c=a("n-input"),w=a("n-button"),P=a("n-card"),U=a("n-modal");return d(),N(U,{class:"go-chart-data-request",show:p.value,"onUpdate:show":o[1]||(o[1]=R=>p.value=R),"mask-closable":!1,closeOnEsc:!0,onEsc:S},{default:t(()=>[e(P,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:t(()=>o[2]||(o[2]=[])),"header-extra":t(()=>o[3]||(o[3]=[])),action:t(()=>[e(q,{justify:"space-between"},{default:t(()=>[i.targetDataRequest?(d(),N(q,{key:0},{default:t(()=>[e(g,{bordered:!1,type:"primary"},{default:t(()=>o[4]||(o[4]=[u("名称：")])),_:1}),e(c,{value:i.targetDataRequest.dataPondName,"onUpdate:value":o[0]||(o[0]=R=>i.targetDataRequest.dataPondName=R),ref_key:"inputInstRef",ref:v,type:"text",size:"small",autofocus:!0,clearable:!0,minlength:1,maxlength:16,placeholder:"请输入名称"},null,8,["value"])]),_:1})):(d(),I("span",Ce)),e(q,null,{default:t(()=>[e(w,{onClick:_},{default:t(()=>o[5]||(o[5]=[u("取消")])),_:1}),e(w,{type:"primary",onClick:h},{default:t(()=>o[6]||(o[6]=[u("保存")])),_:1})]),_:1})]),_:1})]),default:t(()=>[e(x,{style:{"max-height":"718px"}},{default:t(()=>[r("div",Ie,[e(q,{vertical:""},{default:t(()=>[e(n(xe)),e(n(we),{"target-data-request":i.targetDataRequest?.dataPondRequestConfig},null,8,["target-data-request"])]),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Se=V(ke,[["__scopeId","data-v-a969325e"]]),Re={class:"go-chart-data-pond-list"},$e={class:"pond-item-box"},Ee=["onClick"],Oe={class:"item-content"},He={class:"item-content-body"},Te=["onClick"],Ue=M({__name:"index",emits:["createPond","deletePond"],setup(i,{emit:T}){de(g=>({"1013e1a5":C.value}));const k=T,{DuplicateOutlineIcon:m,TrashIcon:E}=Z.ionicons5,v=re(),{chartEditStore:p,targetData:_}=ne(),{requestDataPond:h}=K(p.getRequestGlobalConfig),S=G(()=>_.value.request.requestDataPondId),C=G(()=>v.getAppTheme),o=()=>{k("createPond",!0)},q=(g,c)=>{g.stopPropagation(),g.preventDefault(),k("deletePond",c)},x=g=>{_.value.request.requestDataPondId=g.dataPondId};return(g,c)=>{const w=a("n-timeline-item"),P=a("n-timeline"),U=a("n-icon"),R=a("n-button"),f=a("n-divider"),b=a("n-a"),$=a("n-text"),s=a("n-space"),l=a("n-tag"),y=a("n-ellipsis"),O=a("n-scrollbar");return d(),I("div",Re,[e(P,{class:"pond-item-timeline",style:{width:"20px"}},{default:t(()=>[e(w,{type:"info"}),e(w,{type:"success"})]),_:1}),r("div",$e,[e(R,{class:"create-btn go-py-4",ghost:"",onClick:o},{icon:t(()=>[e(U,null,{default:t(()=>[e(n(m))]),_:1})]),default:t(()=>[c[0]||(c[0]=r("span",null," 创建 ",-1))]),_:1}),e(f,{style:{margin:"10px 0"}}),n(h).length?ee("",!0):(d(),N(s,{key:0,justify:"center"},{default:t(()=>[e($,{class:"not-layer-text",depth:3},{default:t(()=>[c[2]||(c[2]=u(" 暂无数据内容， ")),e(b,{onClick:o},{default:t(()=>c[1]||(c[1]=[u("立即创建")])),_:1})]),_:1})]),_:1})),e(O,{style:{"max-height":"490px"}},{default:t(()=>[(d(!0),I(Y,null,te(n(h),D=>(d(),I("div",{key:D.dataPondId,class:ae([{select:D.dataPondId===S.value},"pond-item"]),onClick:F=>x(D)},[r("div",Oe,[r("div",He,[r("div",null,[e(l,{class:"go-mr-1",type:D.dataPondId===S.value?"warning":"",bordered:!1},{default:t(()=>c[3]||(c[3]=[u(" 名称 ")])),_:2},1032,["type"]),e(y,{style:{"max-width":"180px"}},{default:t(()=>[u(A(D.dataPondName||"暂无"),1)]),_:2},1024)]),r("div",null,[e(l,{class:"go-mr-1",type:D.dataPondId===S.value?"warning":"",bordered:!1},{default:t(()=>c[4]||(c[4]=[u(" 地址 ")])),_:2},1032,["type"]),e(y,{style:{"max-width":"180px"}},{default:t(()=>[u(A(D.dataPondRequestConfig.requestUrl||"暂无"),1)]),_:2},1024)])]),r("div",{class:"item-content-icon go-transition-quick",onClick:F=>q(F,D)},[e(U,null,{default:t(()=>[e(n(E))]),_:1})],8,Te)]),r("div",{class:ae({"select-modal":D.dataPondId===S.value})},null,2)],10,Ee))),128))]),_:1})])])}}});const Ne=V(Ue,[["__scopeId","data-v-43dfb7fe"]]),se=M({__name:"displayTable",props:{target:Object},setup(i){const T=i,k={key:"",value:""},m=me({content:[]});return Q(()=>T.target,E=>{m.content=[];for(const v in E)m.content.push({key:v,value:E[v]});m.content.length||(m.content=[JSON.parse(JSON.stringify(k))])},{immediate:!0,deep:!0}),(E,v)=>{const p=a("n-table");return d(),N(p,{bordered:!1,"single-line":!1,size:"small",style:{"border-bottom-right-radius":"7px","border-bottom-left-radius":"7px"}},{default:t(()=>[v[0]||(v[0]=r("thead",null,[r("tr",null,[r("th",null,"key"),r("th",null,"value")])],-1)),r("tbody",null,[(d(!0),I(Y,null,te(m.content,(_,h)=>(d(),I("tr",{key:h},[r("td",null,A(_.key||"暂无"),1),r("td",null,A(_.value||"暂无"),1)]))),128))])]),_:1})}}}),ze={class:"go-chart-data-display"},Be={class:"go-mr-3"},Ae={key:0},Fe={class:"go-mt-3"},je={key:0},Me={key:1},Le={key:1},Ge=M({__name:"index",props:{globalData:Object,targetData:Object},setup(i){const T=i,{HelpOutlineIcon:k,FlashIcon:m,PulseIcon:E}=Z.ionicons5,{requestUrl:v,requestInterval:p,requestHttpType:_,requestContentType:h,requestSQLContent:S,requestParams:C,requestParamsBodyType:o,requestIntervalUnit:q}=K(T.targetData.dataPondRequestConfig);B.HEADER;const x={[J.DEFAULT]:"普通请求",[J.SQL]:"SQL 请求"},g=H(B.PARAMS);return(c,w)=>{const P=a("n-input"),U=a("n-icon"),R=a("n-divider"),f=a("n-tab"),b=a("n-tabs"),$=a("n-text"),s=a("n-card"),l=a("n-code"),y=a("n-scrollbar");return d(),I("div",ze,[e(y,{style:{"max-height":"570px"}},{default:t(()=>[r("div",Be,[r("div",null,[e(n(z),{name:"主体信息"},{default:t(()=>[e(n(j),{name:"接口名称"},{default:t(()=>[e(P,{size:"small",placeholder:i.targetData?.dataPondName||"暂无",disabled:!0},null,8,["placeholder"])]),_:1}),e(n(j),{name:"接口类型"},{default:t(()=>[e(P,{size:"small",placeholder:n(_)||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),e(n(z),null,{default:t(()=>[e(n(j),{name:"组件间隔"},{default:t(()=>[e(P,{size:"small",placeholder:`${n(p)||"暂无"}`,disabled:!0},{suffix:t(()=>[u(A(i.targetData&&n(oe)[n(q)]),1)]),_:1},8,["placeholder"])]),_:1}),e(n(j),{name:"全局间隔（默认）"},{default:t(()=>[e(P,{size:"small",placeholder:`${i.globalData?.requestInterval||"暂无"}`,disabled:!0},{suffix:t(()=>[u(A(i.globalData&&n(oe)[i.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]),_:1})]),_:1}),e(n(z),{name:"源地址",alone:!0},{default:t(()=>[e(P,{size:"small",placeholder:i.globalData?.requestOriginUrl||"暂无",disabled:!0},{prefix:t(()=>[e(U,{component:n(E)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),e(n(z),{name:"接口地址",alone:!0},{default:t(()=>[e(P,{size:"small",placeholder:n(v)||"暂无",disabled:!0},{prefix:t(()=>[e(U,{component:n(m)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),e(R),e(n(z),{name:"类型"},{default:t(()=>[e(n(j),{name:"配置类型"},{default:t(()=>[e(P,{size:"small",placeholder:i.targetData&&x[n(h)],disabled:!0},null,8,["placeholder"])]),_:1}),n(h)===n(J).DEFAULT?(d(),N(n(j),{key:0,name:"body 类型"},{default:t(()=>[e(P,{size:"small",placeholder:i.targetData&&n(o),disabled:!0},null,8,["placeholder"])]),_:1})):ee("",!0)]),_:1}),n(h)===n(J).DEFAULT?(d(),I("div",Ae,[e(b,{type:"line",animated:"",value:g.value,"onUpdate:value":w[0]||(w[0]=O=>g.value=O)},{default:t(()=>[(d(!0),I(Y,null,te(n(B),O=>(d(),N(f,{key:O,name:O,tab:O},{default:t(()=>[u(A(O),1)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),r("div",Fe,[g.value!==n(B).BODY?(d(),I("div",je,[e(se,{class:"go-my-3",target:n(C)[g.value]},null,8,["target"])])):(d(),I("div",Me,[n(o)===n(L).NONE?(d(),N(s,{key:0,class:"go-mt-3 go-pb-3"},{default:t(()=>[e($,{depth:"3"},{default:t(()=>w[1]||(w[1]=[u("该接口没有 Body 体")])),_:1})]),_:1})):n(o)===n(L).FORM_DATA||n(o)===n(L).X_WWW_FORM_URLENCODED?(d(),N(se,{key:1,class:"go-my-3",target:n(C)[n(B).BODY][n(o)]},null,8,["target"])):n(o)===n(L).JSON?(d(),N(s,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:t(()=>[e(l,{code:n(C)[n(B).BODY][n(o)]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):n(o)===n(L).XML?(d(),N(l,{key:3,code:n(C)[n(B).BODY][n(o)]||"",language:"html"},null,8,["code"])):ee("",!0)]))])])):(d(),I("div",Le,[e(n(z),{name:"键名"},{default:t(()=>[e($,null,{default:t(()=>w[2]||(w[2]=[u("sql")])),_:1})]),_:1}),e(n(z),{name:"键值"},{default:t(()=>[e(l,{code:n(S).sql||"",language:"sql"},null,8,["code"])]),_:1})]))])]),_:1})])}}});const Ve=V(Ge,[["__scopeId","data-v-cc877db2"]]),Ye={class:"pond-content"},We={key:1,class:"no-data go-flex-center"},Je=["src"],Qe=M({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(i,{emit:T}){const k=i,m=T,{PencilIcon:E}=Z.ionicons5,{chartEditStore:v,targetData:p}=ne(),{requestDataPond:_}=K(v.getRequestGlobalConfig),h=H(!1),S=H(!1),C=H(!1),o=H(!1),q=H(),x=G(()=>{const s=p?.value?.request?.requestDataPondId;return s?_.value.filter(y=>s===y.dataPondId)[0]:void 0});Q(()=>k.modelShow,s=>{S.value=s}),Q(()=>x.value,s=>{C.value=!0,q.value=s,pe(()=>{C.value=!1})},{immediate:!0});const g=(s=!1)=>{o.value=!!s,h.value=!0},c=()=>{const s=_e();q.value={dataPondId:s,dataPondName:s,dataPondRequestConfig:fe.cloneDeep({...he,requestDataType:le.Pond})},g()},w=s=>{o.value?P(s):U(s),o.value=!1,h.value=!1},P=s=>{try{const l=_.value.findIndex(y=>y.dataPondId===s.dataPondId);l!==-1?(_.value.splice(l,1,s),v.getComponentList.forEach(y=>{y.request.requestDataType===le.Pond&&y.request.requestDataPondId===s.dataPondId&&(y.request={...X(s.dataPondRequestConfig),requestDataPondId:s.dataPondId})}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch{window.$message.error("编辑失败，请稍后重试！")}},U=s=>{try{q.value?(_.value.unshift(s),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch{window.$message.error("创建失败，请稍后重试!")}},R=s=>{ue({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const l=_.value.findIndex(y=>y.dataPondId===s.dataPondId);l!==-1?(_.value.splice(l,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},f=()=>{x.value&&(p.value.request={...X(x.value.dataPondRequestConfig),requestDataPondId:x.value.dataPondId}),m("update:modelShow",!1),m("sendHandle")},b=()=>{m("update:modelShow",!1)},$=()=>{b()};return(s,l)=>{const y=a("n-text"),O=a("n-icon"),D=a("n-button"),F=a("n-space"),ie=a("n-card"),ce=a("n-modal");return d(),I(Y,null,[e(ce,{class:"go-chart-data-pond-control",show:S.value,"onUpdate:show":l[1]||(l[1]=W=>S.value=W),"mask-closable":!1,"close-on-esc":!0,onEsc:$},{default:t(()=>[e(ie,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"650px"}},{header:t(()=>l[3]||(l[3]=[])),"header-extra":t(()=>l[4]||(l[4]=[])),action:t(()=>[e(F,{justify:"space-between"},{default:t(()=>[e(D,{type:"info",secondary:"",disabled:!x.value,onClick:l[0]||(l[0]=W=>g(!0))},{icon:t(()=>[e(O,null,{default:t(()=>[e(n(E))]),_:1})]),default:t(()=>[l[6]||(l[6]=u(" 编辑内容 "))]),_:1},8,["disabled"]),r("div",null,[e(D,{class:"go-mr-3",onClick:b},{default:t(()=>l[7]||(l[7]=[u("取消")])),_:1}),e(D,{type:"primary",onClick:f},{default:t(()=>l[8]||(l[8]=[u("保存 & 发送请求")])),_:1})])]),_:1})]),default:t(()=>[r("div",Ye,[x.value&&!C.value?(d(),N(n(Ve),{key:0,targetData:x.value,globalData:n(v).getRequestGlobalConfig},null,8,["targetData","globalData"])):(d(),I("div",We,[r("img",{src:n(qe),alt:"暂无数据"},null,8,Je),e(y,{depth:3},{default:t(()=>l[5]||(l[5]=[u("暂未选择公共接口")])),_:1})])),e(n(Ne),{onCreatePond:c,onDeletePond:R})])]),_:1})]),_:1},8,["show"]),e(n(Se),{modelShow:h.value,"onUpdate:modelShow":l[2]||(l[2]=W=>h.value=W),targetDataRequest:q.value,isEdit:o.value,onEditSaveHandle:w},null,8,["modelShow","targetDataRequest","isEdit"])],64)}}});const Xe=V(Qe,[["__scopeId","data-v-cb258d69"]]),Ke={class:"go-chart-data-pond"},Ze={class:"go-absolute-center"},et=M({__name:"index",setup(i){de(f=>({"5189590e":P.value}));const T=re(),{HelpOutlineIcon:k,FlashIcon:m,PulseIcon:E,FishIcon:v}=Z.ionicons5,{targetData:p,chartEditStore:_}=ne(),{requestDataPond:h,requestInterval:S,requestIntervalUnit:C}=K(_.getRequestGlobalConfig),o=H(!1),q=H(!1),x=H(!1);let g=0,c;const w=G(()=>{const f=p.value.request.requestDataPondId;return f?h.value.filter($=>f===$.dataPondId)[0]:void 0}),P=G(()=>T.getAppTheme),U=()=>{q.value=!0},R=async()=>{if(!p.value?.request){window.$message.warning("请选择一个公共接口！");return}o.value=!0;try{const f=await be(X(p.value.request),X(_.getRequestGlobalConfig));if(o.value=!1,f){if(!f?.data&&!p.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),x.value=!0;return}p.value.option.dataset=ye(f?.data,f,p.value.filter),x.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(f){console.error(f),o.value=!1,window.$message.warning("数据异常，请检查参数！")}};return ge(()=>{const f=p.value?.filter;c!==f&&g&&(c=f,R()),g++}),ve(()=>{c=null}),(f,b)=>{const $=a("n-icon"),s=a("n-input"),l=a("n-button"),y=a("n-card"),O=a("n-tooltip"),D=a("go-skeleton");return d(),I(Y,null,[r("div",Ke,[e(y,{class:"n-card-shallow"},{default:t(()=>[e(n(z),{name:"请求名称",alone:!0},{default:t(()=>[e(s,{size:"small",placeholder:w.value?.dataPondName||"暂无",disabled:!0},{prefix:t(()=>[e($,{component:n(v)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),e(n(z),{name:"接口地址",alone:!0},{default:t(()=>[e(s,{size:"small",placeholder:w.value?.dataPondRequestConfig.requestUrl||"暂无",disabled:!0},{prefix:t(()=>[e($,{component:n(m)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),r("div",{class:"edit-text",onClick:U},[r("div",Ze,[e(l,{type:"primary",secondary:""},{default:t(()=>b[1]||(b[1]=[u("编辑配置")])),_:1})])])]),_:1})]),e(n(z),{alone:!0},{name:t(()=>[b[3]||(b[3]=u(" 测试 ")),e(O,{trigger:"hover"},{trigger:t(()=>[e($,{size:"21",depth:3},{default:t(()=>[e(n(k))]),_:1})]),default:t(()=>[b[2]||(b[2]=u(" 默认赋值给 dataset 字段 "))]),_:1})]),default:t(()=>[e(l,{type:"primary",ghost:"",onClick:R},{icon:t(()=>[e($,null,{default:t(()=>[e(n(m))]),_:1})]),default:t(()=>[b[4]||(b[4]=u(" 发送请求 "))]),_:1})]),_:1}),e(n(De),{show:x.value&&!o.value,ajax:!0},null,8,["show"]),e(D,{load:o.value,repeat:3},null,8,["load"]),e(n(Xe),{modelShow:q.value,"onUpdate:modelShow":b[0]||(b[0]=F=>q.value=F),onSendHandle:R},null,8,["modelShow"])],64)}}});const Pt=V(et,[["__scopeId","data-v-19fefd48"]]);export{Pt as default};
