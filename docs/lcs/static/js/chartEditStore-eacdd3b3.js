var P=Object.defineProperty;var y=(t,e,s)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var f=(t,e,s)=>(y(t,typeof e!="symbol"?e+"":e,s),s);import{aK as B,aL as V,aM as q,aN as F,aO as K,aP as Y,I as U,aQ as W,a8 as k,aR as H,aS as j,X,aT as z,aU as $,aV as J,aW as Q,aX as Z,aY as tt,aZ as m,a_ as E,a6 as w,a7 as et,a$ as st}from"./index-3cca530d.js";import{a as C,b as n,l as T}from"./plugin-ede68460.js";var G=(t=>(t.ECHARTS="echarts",t.VCHART="VChart",t.NAIVE_UI="naiveUI",t.COMMON="common",t.STATIC="static",t))(G||{});const St=[{label:"正常",value:"normal"},{label:"正片叠底",value:"multiply"},{label:"叠加",value:"overlay"},{label:"滤色",value:"screen"},{label:"变暗",value:"darken"},{label:"变亮",value:"lighten"},{label:"颜色减淡",value:"color-dodge"},{label:"颜色加深",value:"color-burn;"},{label:"强光",value:"hard-light"},{label:"柔光",value:"soft-light"},{label:"差值",value:"difference"},{label:"排除",value:"exclusion"},{label:"色相",value:"hue"},{label:"饱和度",value:"saturation"},{label:"颜色",value:"color"},{label:"亮度",value:"luminosity"}];var rt=(t=>(t.CHARTS="Charts",t.VCHART="VChart",t.TABLES="Tables",t.INFORMATIONS="Informations",t.PHOTOS="Photos",t.ICONS="Icons",t.DECORATES="Decorates",t.CESIUM="Cesium",t))(rt||{}),at=(t=>(t.CHARTS="图表",t.VCHART="VChart",t.TABLES="列表",t.INFORMATIONS="信息",t.PHOTOS="图片",t.ICONS="图标",t.DECORATES="小组件",t.CESIUM="三维",t))(at||{}),ot=(t=>(t[t.VIEW=0]="VIEW",t[t.CONFIG=1]="CONFIG",t))(ot||{}),_=(t=>(t.ON_CLICK="click",t.ON_DBL_CLICK="dblclick",t.ON_MOUSE_ENTER="mouseenter",t.ON_MOUSE_LEAVE="mouseleave",t))(_||{}),it=(t=>(t.CLICK="click",t.CHANGE="change",t))(it||{});const Lt="componentInteractEventKey";var M=(t=>(t.VNODE_MOUNTED="vnodeMounted",t.VNODE_BEFORE_MOUNT="vnodeBeforeMount",t))(M||{});const nt={requestDataType:B.STATIC,requestHttpType:V.GET,requestUrl:"",requestInterval:void 0,requestIntervalUnit:q.SECOND,requestContentType:F.DEFAULT,requestParamsBodyType:K.NONE,requestSQLContent:{sql:"select * from  where"},requestParams:{Body:{"form-data":{},"x-www-form-urlencoded":{},json:"",xml:""},Header:{},Params:{}}};class ht{constructor(){f(this,"id",U());f(this,"isGroup",!1);f(this,"attr",{...W,zIndex:-1});f(this,"styles",{filterShow:!1,hueRotate:0,saturate:1,contrast:1,brightness:1,opacity:1,rotateZ:0,rotateX:0,rotateY:0,skewX:0,skewY:0,blendMode:"normal",animations:[]});f(this,"preview",{overFlowHidden:!1});f(this,"status",{lock:!1,hide:!1});f(this,"request",k(nt));f(this,"filter");f(this,"events",{baseEvent:{[_.ON_CLICK]:void 0,[_.ON_DBL_CLICK]:void 0,[_.ON_MOUSE_ENTER]:void 0,[_.ON_MOUSE_LEAVE]:void 0},advancedEvents:{[M.VNODE_MOUNTED]:void 0,[M.VNODE_BEFORE_MOUNT]:void 0},interactEvents:[]})}}class ct extends ht{constructor(){super(...arguments);f(this,"isGroup",!0);f(this,"chartConfig",{key:"group",chartKey:"group",conKey:"group",category:"group",categoryName:"group",package:"group",chartFrame:G.COMMON,title:Y,image:""});f(this,"groupList",[]);f(this,"key","group");f(this,"option",{});f(this,"id",U());f(this,"attr",{w:0,h:0,x:0,y:0,offsetX:0,offsetY:0,zIndex:-1})}}var o=(t=>(t.ADD="add",t.DELETE="delete",t.UPDATE="update",t.MOVE="move",t.COPY="copy",t.CUT="cut",t.PASTE="paste",t.TOP="top",t.BOTTOM="bottom",t.UP="up",t.DOWN="down",t.GROUP="group",t.UN_GROUP="unGroup",t.LOCK="lock",t.UNLOCK="unLock",t.HIDE="hide",t.SHOW="show",t))(o||{}),d=(t=>(t.CANVAS="canvas",t.CHART="chart",t))(d||{}),lt=(t=>(t.BACK_STACK="backStack",t.FORWARD_STACK="forwardStack",t))(lt||{}),D=(t=>(t.ID="id",t.TARGET_TYPE="targetType",t.ACTION_TYPE="actionType",t.HISTORY_DATA="historyData",t))(D||{});const ut=H({id:"useChartHistoryStore",state:()=>({backStack:[],forwardStack:[]}),getters:{getBackStack(){return this.backStack},getForwardStack(){return this.forwardStack}},actions:{createStackItem(t,e,s=d.CHART){this.pushBackStackItem(Object.freeze({[D.ID]:new Date().getTime().toString(),[D.HISTORY_DATA]:t,[D.ACTION_TYPE]:e,[D.TARGET_TYPE]:s}))},canvasInit(t){this.createStackItem([t],o.ADD,d.CANVAS)},pushBackStackItem(t,e=!1){t instanceof Array?this.backStack=[...this.backStack,...t]:this.backStack.push(t),this.backStack.splice(0,this.backStack.length-j),!e&&this.clearForwardStack()},pushForwardStack(t){t instanceof Array?this.forwardStack=[...this.forwardStack,...t]:this.forwardStack.push(t)},popBackStackItem(){if(this.backStack.length>0)return this.backStack.pop()},popForwardStack(){if(this.forwardStack.length>0)return this.forwardStack.pop()},clearForwardStack(){this.forwardStack=[]},clearBackStack(){const t=this.getBackStack[0];this.backStack=[t]},backAction(){try{if(C(),this.getBackStack.length>1){const t=this.popBackStackItem();if(!t){n();return}return this.pushForwardStack(t),n(),t}n()}catch{T()}},forwardAction(){try{if(C(),this.getForwardStack.length){const t=this.popForwardStack();if(!t){n();return}return this.pushBackStackItem(t,!0),n(),t}n()}catch{T()}},createAddHistory(t){this.createStackItem(t,o.ADD,d.CHART)},createUpdateHistory(t){this.createStackItem(t,o.UPDATE,d.CHART)},createDeleteHistory(t){this.createStackItem(t,o.DELETE,d.CHART)},createMoveHistory(t){this.createStackItem(t,o.MOVE,d.CHART)},createLayerHistory(t,e){this.createStackItem(t,e,d.CHART)},createPasteHistory(t){this.createStackItem(t,o.CUT,d.CHART)},createGroupHistory(t){this.createStackItem(t,o.GROUP,d.CHART)},createUnGroupHistory(t){this.createStackItem(t,o.UN_GROUP,d.CHART)},createLockHistory(t){this.createStackItem(t,o.LOCK,d.CHART)},createUnLockHistory(t){this.createStackItem(t,o.UNLOCK,d.CHART)},createHideHistory(t){this.createStackItem(t,o.HIDE,d.CHART)},createShowHistory(t){this.createStackItem(t,o.SHOW,d.CHART)}}});var ft=(t=>(t.PROJECT_ID="projectId",t.PROJECT_NAME="projectName",t.REMARKS="remarks",t.THUMBNAIL="thumbnail",t.RELEASE="release",t))(ft||{}),x=(t=>(t.EDIT_LAYOUT_DOM="editLayoutDom",t.EDIT_CONTENT_DOM="editContentDom",t.OFFSET="offset",t.SCALE="scale",t.USER_SCALE="userScale",t.LOCK_SCALE="lockScale",t.SAVE_STATUS="saveStatus",t.IS_CREATE="isCreate",t.IS_DRAG="isDrag",t.IS_SELECT="isSelect",t.IS_CODE_EDIT="isCodeEdit",t))(x||{}),dt=(t=>(t.PROJECT_NAME="projectName",t.WIDTH="width",t.HEIGHT="height",t.CHART_THEME_COLOR="chartThemeColor",t.CHART_CUSTOM_THEME_COLOR_INFO="chartCustomThemeColorInfo",t.CHART_THEME_SETTING="chartThemeSetting",t.VCHART_THEME_NAME="vChartThemeName",t.BACKGROUND="background",t.BACKGROUND_IMAGE="backgroundImage",t.SELECT_COLOR="selectColor",t.PREVIEW_SCALE_TYPE="previewScaleType",t))(dt||{}),x=(t=>(t.START_X="startX",t.START_Y="startY",t.X="x",t.Y="y",t))(x||{}),b=(t=>(t.PROJECT_INFO="projectInfo",t.EDIT_RANGE="editRange",t.EDIT_CANVAS="editCanvas",t.RIGHT_MENU_SHOW="rightMenuShow",t.MOUSE_POSITION="mousePosition",t.TARGET_CHART="targetChart",t.RECORD_CHART="recordChart",t.EDIT_CANVAS_CONFIG="editCanvasConfig",t.REQUEST_GLOBAL_CONFIG="requestGlobalConfig",t.COMPONENT_LIST="componentList",t))(b||{});const g=ut(),gt=X(),It=H({id:"useChartEditStore",state:()=>({projectInfo:{projectId:"",projectName:"",remarks:"",thumbnail:"",release:!1},editCanvas:{editLayoutDom:null,editContentDom:null,offset:20,scale:1,userScale:1,lockScale:!1,isCreate:!1,isDrag:!1,isSelect:!1,saveStatus:z.PENDING,isCodeEdit:!1},rightMenuShow:!1,mousePosition:{startX:0,startY:0,x:0,y:0},targetChart:{hoverId:void 0,selectId:[]},recordChart:void 0,editCanvasConfig:{projectName:void 0,width:1920,height:1080,filterShow:!1,hueRotate:0,saturate:1,contrast:1,brightness:1,opacity:1,rotateZ:0,rotateX:0,rotateY:0,skewX:0,skewY:0,blendMode:"normal",background:void 0,backgroundImage:void 0,selectColor:!0,chartThemeColor:$,chartCustomThemeColorInfo:void 0,chartThemeSetting:J,vChartThemeName:"vScreenVolcanoBlue",previewScaleType:Q},requestGlobalConfig:{requestDataPond:[],requestOriginUrl:"",requestInterval:Z,requestIntervalUnit:tt,requestParams:{Body:{"form-data":{},"x-www-form-urlencoded":{},json:"",xml:""},Header:{},Params:{}}},componentList:[]}),getters:{getProjectInfo(){return this.projectInfo},getMousePosition(){return this.mousePosition},getRightMenuShow(){return this.rightMenuShow},getEditCanvas(){return this.editCanvas},getEditCanvasConfig(){return this.editCanvasConfig},getTargetChart(){return this.targetChart},getRecordChart(){return this.recordChart},getRequestGlobalConfig(){return this.requestGlobalConfig},getComponentList(){return this.componentList}},actions:{getStorageInfo(){return{[b.EDIT_CANVAS_CONFIG]:this.getEditCanvasConfig,[b.COMPONENT_LIST]:this.getComponentList,[b.REQUEST_GLOBAL_CONFIG]:this.getRequestGlobalConfig}},getSelectIdSortList(t){if(!this.getTargetChart.selectId.length&&!t)return[];const e=[];return this.getComponentList.forEach(s=>{t?t.forEach(r=>{s.id===r&&e.push(r)}):this.getTargetChart.selectId.forEach(r=>{s.id===r&&e.push(r)})}),e},setEditCanvas(t,e){this.editCanvas[t]=e},setEditCanvasConfig(t,e){this.editCanvasConfig[t]=e},setProjectInfo(t,e){this.projectInfo[t]=e},setRightMenuShow(t){this.rightMenuShow=t},setTargetHoverChart(t){this.targetChart.hoverId=t},setTargetSelectChart(t,e=!1){if(!this.targetChart.selectId.find(s=>s===t)){if(!t){this.targetChart.selectId=[];return}if(e){if(m(t)){this.targetChart.selectId.push(t);return}if(E(t)){this.targetChart.selectId.push(...t);return}}else{if(m(t)){this.targetChart.selectId=[t];return}if(E(t)){this.targetChart.selectId=t;return}}}},setRecordChart(t){this.recordChart=k(t)},setMousePosition(t,e,s,r){t&&(this.mousePosition.x=t),e&&(this.mousePosition.y=e),s&&(this.mousePosition.startX=s),r&&(this.mousePosition.startY=r)},fetchTargetIndex(t){const e=t||this.getTargetChart.selectId.length&&this.getTargetChart.selectId[0]||void 0;if(!e)return n(),-1;const s=this.componentList.findIndex(r=>r.id===e);if(s!==-1)return s;{const r=this.getComponentList.length;for(let a=0;a<r;a++)if(this.getComponentList[a].isGroup){for(const c of this.getComponentList[a].groupList)if(c.id===e)return a}}return-1},idPreFormat(t){const e=[];return t?(m(t)&&e.push(t),E(t)&&e.push(...t),e):(e.push(...this.getTargetChart.selectId),e)},addComponentList(t,e=!1,s=!1){if(t instanceof Array){t.forEach(r=>{this.addComponentList(r,e,s)});return}if(s&&g.createAddHistory([t]),e){this.componentList.unshift(t);return}this.componentList.push(t)},removeComponentList(t,e=!0){try{const s=this.idPreFormat(t),r=[];if(!s.length)return;C(),s.forEach(a=>{const c=this.fetchTargetIndex(a);c!==-1&&(r.push(this.getComponentList[c]),this.componentList.splice(c,1))}),e&&g.createDeleteHistory(r),n();return}catch{T()}},resetComponentPosition(t,e){const s=this.fetchTargetIndex(t.id);if(s>-1){const r=this.getComponentList[s];e?r.attr=Object.assign(r.attr,{x:t.attr.x+t.attr.offsetX,y:t.attr.y+t.attr.offsetY}):r.attr=Object.assign(r.attr,{x:t.attr.x,y:t.attr.y})}},moveComponentList(t){g.createMoveHistory(t)},updateComponentList(t,e){t<1&&t>this.getComponentList.length||(this.componentList[t]=e)},setPageStyle(t,e){const s=this.getEditCanvas.editContentDom;s&&(s.style[t]=e)},setBothEnds(t=!1,e=!0){try{if(this.getTargetChart.selectId.length>1)return;C();const s=this.getComponentList.length;if(s<2){n();return}const r=this.fetchTargetIndex(),a=this.getComponentList[r];if(r!==-1){if(t&&r===0||!t&&r===s-1){n();return}const c=(u,i)=>{const h=k(u);return h.attr.zIndex=i,h};e&&g.createLayerHistory([c(a,r)],t?o.BOTTOM:o.TOP),this.addComponentList(a,t),this.getComponentList.splice(t?r+1:r,1),n();return}}catch{T()}},setTop(t=!0){this.setBothEnds(!1,t)},setBottom(t=!0){this.setBothEnds(!0,t)},wrap(t=!1,e=!0){try{if(this.getTargetChart.selectId.length>1)return;C();const s=this.getComponentList.length;if(s<2){n();return}const r=this.fetchTargetIndex();if(r!==-1){if(t&&r===0||!t&&r===s-1){n();return}const a=t?r-1:r+1,c=this.getComponentList[r],u=this.getComponentList[a];e&&g.createLayerHistory([c],t?o.DOWN:o.UP),this.updateComponentList(r,u),this.updateComponentList(a,c),n();return}}catch{T()}},setUp(t=!0){this.wrap(!1,t)},setDown(t=!0){this.wrap(!0,t)},setCopy(t=!1){try{if(this.getTargetChart.selectId.length>1||document.getElementsByClassName("n-modal-body-wrapper").length)return;C();const e=this.fetchTargetIndex();if(e!==-1){const s={charts:this.getComponentList[e],type:t?o.CUT:o.COPY};this.setRecordChart(s),window.$message.success(t?"剪切图表成功":"复制图表成功！"),n()}}catch{T()}},setCut(){this.setCopy(!0)},setParse(){try{C();const t=this.getRecordChart;if(t===void 0){n();return}const e=a=>(a=k(a),a.attr.x=this.getMousePosition.startX,a.attr.y=this.getMousePosition.startY,a.id=U(),a.isGroup&&a.groupList.forEach(c=>{c.id=U()}),a),s=t.type===o.CUT;(Array.isArray(t.charts)?t.charts:[t.charts]).forEach(a=>{this.addComponentList(e(a),void 0,!0),s&&(this.setTargetSelectChart(a.id),this.removeComponentList(void 0,!0))}),s&&this.setRecordChart(void 0),n()}catch{T()}},setBackAndSetForwardHandle(t,e=!1){if(t.targetType===d.CANVAS){this.editCanvas=t.historyData[0];return}this.setTargetSelectChart();let s=t.historyData;E(s)&&s.forEach(l=>{this.setTargetSelectChart(l.id,!0)});const r=t.actionType===o.ADD,a=t.actionType===o.DELETE;if(r||a){if(r&&e||a&&!e){s.forEach(l=>{this.addComponentList(l)});return}s.forEach(l=>{this.removeComponentList(l.id,!1)});return}if(t.actionType===o.MOVE){s.forEach(l=>{this.resetComponentPosition(l,e)});return}const u=t.actionType===o.TOP,i=t.actionType===o.BOTTOM;if(u||i){if(!e){u&&this.getComponentList.pop(),i&&this.getComponentList.shift(),this.getComponentList.splice(s[0].attr.zIndex,0,s[0]);return}u&&this.setTop(!1),i&&this.setBottom(!1)}const h=t.actionType===o.UP,L=t.actionType===o.DOWN;if(h||L){if(h&&e||L&&!e){this.setUp(!1);return}this.setDown(!1);return}const I=t.actionType===o.GROUP,p=t.actionType===o.UN_GROUP;if(I||p){if(I&&e||p&&!e){const l=[];s.length>1?s.forEach(R=>{l.push(R.id)}):s[0].groupList.forEach(N=>{l.unshift(N.id)}),this.setGroup(l,!1);return}s.length>1?this.setUnGroup([s[0].id],void 0,!1):this.setUnGroup([s[0].groupList[0].id],void 0,!1);return}const S=t.actionType===o.LOCK,O=t.actionType===o.UNLOCK;if(S||O){if(S&&e||O&&!e){s.forEach(l=>{this.setLock(!l.status.lock,!1)});return}s.forEach(l=>{this.setUnLock(!1)});return}const v=t.actionType===o.HIDE,A=t.actionType===o.SHOW;if(v||A){if(v&&e||A&&!e){s.forEach(l=>{this.setHide(!l.status.hide,!1)});return}s.forEach(l=>{this.setShow(!1)});return}},setBack(){try{C();const t=g.backAction();if(!t){n();return}this.setBackAndSetForwardHandle(t),n()}catch{T()}},setForward(){try{C();const t=g.forwardAction();if(!t){n();return}this.setBackAndSetForwardHandle(t,!0),n()}catch{T()}},setMove(t){const e=this.fetchTargetIndex();if(e===-1)return;const s=this.getComponentList[e].attr,r=gt.getChartMoveDistance;switch(t){case w.ARROW_UP:s.y-=r;break;case w.ARROW_RIGHT:s.x+=r;break;case w.ARROW_DOWN:s.y+=r;break;case w.ARROW_LEFT:s.x-=r;break}},setGroup(t,e=!0){try{let s=this.idPreFormat(t)||this.getTargetChart.selectId;if(s=this.getSelectIdSortList(s),s.length<2)return;C();const r=new ct,a=[],c=[],u=[];s.forEach(h=>{const L=this.fetchTargetIndex(h);L!==-1&&this.getComponentList[L].isGroup?this.setUnGroup([h],I=>{I.forEach(p=>{this.addComponentList(p),u.push(p.id)})},!1):L!==-1&&u.push(h)});const i={l:0,t:0,r:0,b:0};u.forEach((h,L)=>{const I=this.componentList.splice(this.fetchTargetIndex(h),1)[0],{x:p,y:S,w:O,h:v}=I.attr;if(L===0)i.l=p,i.t=S,i.r=p+O,i.b=S+v;else{const{l:A,t:l,r:R,b:N}=i;i.l=A>p?p:A,i.t=l>S?S:l,i.r=R<p+O?p+O:R,i.b=N<S+v?S+v:N}a.push(I),c.push(et(I))}),e&&g.createGroupHistory(c),a.forEach(h=>{h.attr.x=h.attr.x-i.l,h.attr.y=h.attr.y-i.t,r.groupList.push(h)}),r.attr.x=i.l,r.attr.y=i.t,r.attr.w=i.r-i.l,r.attr.h=i.b-i.t,this.addComponentList(r),this.setTargetSelectChart(r.id),n()}catch(s){console.log(s),window.$message.error("创建分组失败，请联系管理员"),n()}},setUnGroup(t,e,s=!0){try{const r=t||this.getTargetChart.selectId;if(r.length!==1)return;C();const a=u=>{const i=this.getComponentList[u];i.isGroup&&(s&&g.createUnGroupHistory(k([i])),i.groupList.forEach(h=>{h.attr.x=h.attr.x+i.attr.x,h.attr.y=h.attr.y+i.attr.y,e||this.addComponentList(h)}),this.setTargetSelectChart(i.id),this.removeComponentList(i.id,!1),e&&e(i.groupList))},c=this.fetchTargetIndex(r[0]);c!==-1&&a(c),n()}catch(r){console.log(r),window.$message.error("解除分组失败，请联系管理员"),n()}},setLock(t=!0,e=!0){try{if(this.getTargetChart.selectId.length>1)return;C();const s=this.fetchTargetIndex();if(s!==-1){const r=this.getComponentList[s];r.status.lock=t,e&&(t?g.createLockHistory([r]):g.createUnLockHistory([r])),this.updateComponentList(s,r),t&&this.setTargetSelectChart(void 0),n();return}}catch{T()}},setUnLock(t=!0){this.setLock(!1,t)},setHide(t=!0,e=!0){try{if(this.getTargetChart.selectId.length>1)return;C();const s=this.fetchTargetIndex();if(s!==-1){const r=this.getComponentList[s];r.status.hide=t,e&&(t?g.createHideHistory([r]):g.createShowHistory([r])),this.updateComponentList(s,r),n(),t&&this.setTargetSelectChart(void 0)}}catch{T()}},setShow(t=!0){this.setHide(!1,t)},setPageSize(t){this.setPageStyle("height",`${this.editCanvasConfig.height*t}px`),this.setPageStyle("width",`${this.editCanvasConfig.width*t}px`)},computedScale(){if(this.getEditCanvas.editLayoutDom){const t=this.getEditCanvas.editLayoutDom.clientWidth-this.getEditCanvas.offset*2-5,e=this.getEditCanvas.editLayoutDom.clientHeight-this.getEditCanvas.offset*4,s=this.editCanvasConfig.width,r=this.editCanvasConfig.height,a=parseFloat((s/r).toFixed(5));if(parseFloat((t/e).toFixed(5))>a){const u=parseFloat((e*a/s).toFixed(5));this.setScale(u>1?1:u)}else{const u=parseFloat((t/a/r).toFixed(5));this.setScale(u>1?1:u)}}else window.$message.warning("请先创建画布，再进行缩放")},listenerScale(){const t=st(this.computedScale,200);return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},setScale(t,e=!1){(!this.getEditCanvas.lockScale||e)&&(this.setPageSize(t),this.getEditCanvas.userScale=t,this.getEditCanvas.scale=t)}}});export{_ as B,b as C,dt as E,ot as F,lt as H,it as I,ft as P,ut as a,rt as b,at as c,ht as d,G as e,M as f,x as g,ct as h,Lt as i,o as j,d as k,St as l,nt as r,It as u};
